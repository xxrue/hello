<!doctype html>
<html lang="ms">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Operasi Set: Kesatuan Set</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800;900&display=swap');
    
    body {
      box-sizing: border-box;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      padding: 0;
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 50%, #c2e9fb 100%);
      min-height: 100%;
      width: 100%;
    }
    
    .main-wrapper {
      width: 100%;
      min-height: 100%;
      padding: 40px 20px;
    }
    
    .content-container {
      max-width: 1400px;
      margin: 0 auto;
      width: 100%;
      display: grid;
      grid-template-columns: 400px 1fr;
      gap: 30px;
      align-items: start;
    }
    
    .left-panel {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 24px;
      padding: 36px;
      box-shadow: 0 20px 60px rgba(251, 194, 235, 0.3);
      position: sticky;
      top: 20px;
      border: 2px solid rgba(255, 255, 255, 0.8);
    }
    
    header {
      margin-bottom: 32px;
      padding-bottom: 24px;
      border-bottom: 4px solid #fbc2eb;
    }

    .language-toggle {
      display: flex;
      background: linear-gradient(135deg, #fff9fd, #f5faff);
      border-radius: 12px;
      padding: 4px;
      border: 3px solid #fde2f3;
      box-shadow: 0 4px 12px rgba(251, 194, 235, 0.2);
      margin-bottom: 20px;
      width: fit-content;
    }

    .language-toggle button {
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 800;
      font-family: 'Poppins', sans-serif;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      background: transparent;
      color: #b08db5;
    }

    .language-toggle button.active {
      background: linear-gradient(135deg, #fbc2eb 0%, #d998c5 100%);
      color: #6b4c7a;
      box-shadow: 0 2px 8px rgba(251, 194, 235, 0.4);
    }

    .language-toggle button:hover:not(.active) {
      color: #6b4c7a;
    }
    
    h1 {
      color: #6b4c7a;
      font-size: 32px;
      margin: 0 0 12px 0;
      font-weight: 900;
      line-height: 1.2;
      letter-spacing: -0.5px;
    }
    
    .instruction {
      color: #8b7a9e;
      font-size: 15px;
      margin: 0;
      line-height: 1.6;
      font-weight: 500;
    }
    
    .legend {
      margin-bottom: 32px;
      padding: 24px;
      background: linear-gradient(135deg, #fff5fc, #f0f7ff);
      border-radius: 16px;
      border: 2px solid #fde2f3;
    }
    
    .legend h3 {
      margin: 0 0 16px 0;
      font-size: 16px;
      color: #6b4c7a;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 10px 0;
      font-size: 15px;
      color: #6b4c7a;
      font-weight: 600;
    }
    
    .legend-symbol {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: white;
      border-radius: 8px;
      font-weight: 800;
      font-size: 18px;
      color: #d998c5;
      box-shadow: 0 4px 8px rgba(251, 194, 235, 0.3);
    }
    
    .legend-divider {
      margin: 16px 0;
      padding-top: 16px;
      border-top: 2px solid #fde2f3;
    }

    .score-display {
      margin-bottom: 24px;
      padding: 20px;
      background: linear-gradient(135deg, #fff, #fef5fb);
      border-radius: 16px;
      border: 3px solid #fbc2eb;
      text-align: center;
    }

    .score-label {
      font-size: 13px;
      font-weight: 800;
      color: #b08db5;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      margin-bottom: 8px;
    }

    .score-value {
      font-size: 36px;
      font-weight: 900;
      color: #6b4c7a;
      font-family: 'Poppins', sans-serif;
    }
    
    .question-display {
      margin-bottom: 24px;
      padding: 24px;
      background: linear-gradient(135deg, #fff, #fef5fb);
      border-radius: 16px;
      border: 3px solid #fbc2eb;
      box-shadow: 0 8px 20px rgba(251, 194, 235, 0.3);
      text-align: center;
    }

    .question-label {
      font-size: 12px;
      font-weight: 800;
      color: #b08db5;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      margin-bottom: 12px;
    }

    .question-text {
      font-size: 28px;
      font-weight: 900;
      color: #6b4c7a;
      font-family: 'Poppins', sans-serif;
      letter-spacing: 2px;
      line-height: 1.4;
      word-break: break-word;
    }

    .feedback-section {
      margin-bottom: 24px;
      padding: 20px;
      background: linear-gradient(135deg, #fff5fc, #f0f7ff);
      border-radius: 16px;
      border: 2px solid #fde2f3;
      min-height: 80px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .feedback-legend {
      display: flex;
      flex-direction: column;
      gap: 8px;
      width: 100%;
    }

    .feedback-legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      color: #6b4c7a;
      font-weight: 600;
    }

    .feedback-color-box {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      border: 2px solid rgba(0, 0, 0, 0.1);
    }

    .button-group {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    
    button {
      width: 100%;
      padding: 18px 28px;
      font-size: 16px;
      font-weight: 800;
      font-family: 'Poppins', sans-serif;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 1.2px;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }
    
    .btn-check {
      background: linear-gradient(135deg, #fbc2eb 0%, #d998c5 100%);
      color: #6b4c7a;
      box-shadow: 0 6px 16px rgba(251, 194, 235, 0.5);
    }
    
    .btn-check:hover:not(:disabled) {
      background: linear-gradient(135deg, #f9aedd 0%, #d085b8 100%);
      transform: translateY(-3px);
      box-shadow: 0 10px 24px rgba(251, 194, 235, 0.6);
    }
    
    .btn-check:active:not(:disabled) {
      transform: translateY(0);
    }
    
    .btn-next {
      background: linear-gradient(135deg, #81c784, #66bb6a);
      color: white;
      box-shadow: 0 6px 16px rgba(129, 199, 132, 0.5);
    }
    
    .btn-next:hover:not(:disabled) {
      background: linear-gradient(135deg, #66bb6a, #4caf50);
      transform: translateY(-3px);
      box-shadow: 0 10px 24px rgba(129, 199, 132, 0.6);
    }

    .btn-reset {
      background: linear-gradient(135deg, #e3f2fd, #bbdefb);
      color: #4a7ba7;
      border: 3px solid #c2e9fb;
    }
    
    .btn-reset:hover:not(:disabled) {
      background: linear-gradient(135deg, #d1e9fc, #a6d4f7);
      border-color: #a6c1ee;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(166, 193, 238, 0.4);
    }
    
    .venn-container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 24px;
      padding: 60px;
      box-shadow: 0 20px 60px rgba(251, 194, 235, 0.3);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 650px;
      border: 2px solid rgba(255, 255, 255, 0.8);
    }
    
    canvas {
      max-width: 100%;
      height: auto;
      cursor: pointer;
    }

    canvas.disabled {
      cursor: not-allowed;
      opacity: 0.7;
    }
    
    @media (max-width: 1200px) {
      .content-container {
        grid-template-columns: 1fr;
      }
      
      .left-panel {
        position: relative;
        top: 0;
      }
    }
    
    @media (max-width: 768px) {
      .main-wrapper {
        padding: 20px 16px;
      }
      
      h1 {
        font-size: 26px;
      }
      
      .instruction {
        font-size: 14px;
      }
      
      .left-panel {
        padding: 28px;
      }
      
      .venn-container {
        padding: 32px;
        min-height: 450px;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <main class="main-wrapper">
   <div class="content-container">
    <aside class="left-panel">
     <header>
      <div class="language-toggle"><button id="langBM" class="active" aria-label="Switch to Malay">BM</button> <button id="langENG" aria-label="Switch to English">ENG</button>
      </div>
      <h1 id="main-title">Operasi Set: Kesatuan Set</h1>
      <p class="instruction" id="instruction-text">Klik pada kawasan dalam gambar Venn yang mewakili kesatuan set dalam soalan</p>
     </header>
     <div class="score-display">
      <div class="score-label" id="score-label">
       Skor
      </div>
      <div class="score-value" id="score-value">
       0 / 15
      </div>
     </div>
     <div class="legend">
      <h3>Set Semesta (ξ)</h3>
      <div class="legend-item"><span class="legend-symbol" style="color: #f06292;">A</span> <span>Set A</span>
      </div>
      <div class="legend-item"><span class="legend-symbol" style="color: #81c784;">B</span> <span>Set B</span>
      </div>
      <div class="legend-item"><span class="legend-symbol" style="color: #64b5f6;">C</span> <span>Set C</span>
      </div>
      <div class="legend-item"><span class="legend-symbol" style="color: #ba68c8;">D</span> <span>Set D</span>
      </div>
      <div class="legend-item"><span class="legend-symbol" style="color: #ffa726;">E</span> <span>Set E</span>
      </div>
      <div class="legend-divider">
       <div class="legend-item"><span class="legend-symbol">∪</span> <span id="union-label">Kesatuan</span>
       </div>
      </div>
     </div>
     <div class="question-display">
      <div class="question-label" id="question-label">
       Soalan
      </div>
      <div class="question-text" id="question-text">
       A ∪ B
      </div>
     </div>
     <div class="feedback-section" id="feedback-section">
      <div class="feedback-legend" id="feedback-legend" style="display: none;">
       <div class="feedback-legend-item">
        <div class="feedback-color-box" style="background-color: #4caf50;"></div><span id="correct-label">Betul (diklik)</span>
       </div>
       <div class="feedback-legend-item">
        <div class="feedback-color-box" style="background-color: #f44336;"></div><span id="wrong-label">Salah (diklik)</span>
       </div>
       <div class="feedback-legend-item">
        <div class="feedback-color-box" style="background-color: #ffeb3b;"></div><span id="missed-label">Terlepas (tidak diklik)</span>
       </div>
      </div>
     </div>
     <div class="button-group"><button class="btn-check" id="checkBtn">Semak Jawapan</button> <button class="btn-next" id="nextBtn" style="display: none;">Soalan Seterusnya</button> <button class="btn-reset" id="resetBtn">Mula Semula</button>
     </div>
    </aside>
    <div class="venn-container">
     <canvas id="vennCanvas" width="700" height="550"></canvas>
    </div>
   </div>
  </main>
  <script>
    const defaultConfig = {
      main_title: "Operasi Set: Kesatuan Set",
      instruction_text: "Klik pada kawasan dalam gambar Venn yang mewakili kesatuan set dalam soalan"
    };

    async function onConfigChange(config) {
      const titleElement = document.getElementById('main-title');
      const instructionElement = document.getElementById('instruction-text');
      
      if (titleElement) {
        titleElement.textContent = config.main_title || defaultConfig.main_title;
      }
      if (instructionElement) {
        instructionElement.textContent = config.instruction_text || defaultConfig.instruction_text;
      }
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ["main_title", config.main_title || defaultConfig.main_title],
        ["instruction_text", config.instruction_text || defaultConfig.instruction_text]
      ]);
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }

    // Language translations
    const translations = {
      BM: {
        title: "Operasi Set: Kesatuan Set",
        instruction: "Klik pada kawasan dalam gambar Venn yang mewakili kesatuan set dalam soalan",
        universalSet: "Set Semesta (ξ)",
        union: "Kesatuan",
        question: "Soalan",
        score: "Skor",
        checkAnswer: "Semak Jawapan",
        nextQuestion: "Soalan Seterusnya",
        restart: "Mula Semula",
        correctLabel: "Betul (diklik)",
        wrongLabel: "Salah (diklik)",
        missedLabel: "Terlepas (tidak diklik)",
        gameComplete: "Tamat! Skor anda: "
      },
      ENG: {
        title: "Operations on Sets: Union of Sets",
        instruction: "Click on the areas in the Venn diagram that represent the union of sets in the question",
        universalSet: "Universal Set (ξ)",
        union: "Union",
        question: "Question",
        score: "Score",
        checkAnswer: "Check Answer",
        nextQuestion: "Next Question",
        restart: "Restart",
        correctLabel: "Correct (clicked)",
        wrongLabel: "Wrong (clicked)",
        missedLabel: "Missed (not clicked)",
        gameComplete: "Complete! Your score: "
      }
    };

    let currentLanguage = 'BM';

    // Game questions - 15 different union questions
    // Each question has sets involved in the union operation
    const questions = [
      { text: { BM: "A ∪ B", ENG: "A ∪ B" }, sets: ['A', 'B'] },
      { text: { BM: "B ∪ C", ENG: "B ∪ C" }, sets: ['B', 'C'] },
      { text: { BM: "C ∪ D", ENG: "C ∪ D" }, sets: ['C', 'D'] },
      { text: { BM: "D ∪ E", ENG: "D ∪ E" }, sets: ['D', 'E'] },
      { text: { BM: "A ∪ E", ENG: "A ∪ E" }, sets: ['A', 'E'] },
      { text: { BM: "B ∪ C ∪ E", ENG: "B ∪ C ∪ E" }, sets: ['B', 'C', 'E'] },
      { text: { BM: "A ∪ C", ENG: "A ∪ C" }, sets: ['A', 'C'] },
      { text: { BM: "B ∪ D", ENG: "B ∪ D" }, sets: ['B', 'D'] },
      { text: { BM: "A ∪ B ∪ C", ENG: "A ∪ B ∪ C" }, sets: ['A', 'B', 'C'] },
      { text: { BM: "C ∪ E", ENG: "C ∪ E" }, sets: ['C', 'E'] },
      { text: { BM: "A ∪ D", ENG: "A ∪ D" }, sets: ['A', 'D'] },
      { text: { BM: "A ∪ C ∪ D", ENG: "A ∪ C ∪ D" }, sets: ['A', 'C', 'D'] },
      { text: { BM: "B ∪ D ∪ E", ENG: "B ∪ D ∪ E" }, sets: ['B', 'D', 'E'] },
      { text: { BM: "A ∪ B ∪ D", ENG: "A ∪ B ∪ D" }, sets: ['A', 'B', 'D'] },
      { text: { BM: "A ∪ B ∪ C ∪ D ∪ E", ENG: "A ∪ B ∪ C ∪ D ∪ E" }, sets: ['A', 'B', 'C', 'D', 'E'] }
    ];
    
    // Helper function to check if a region contains any of the specified sets
    function regionContainsSets(region, sets) {
      // A region is correct if it contains at least one of the sets in the union
      return sets.some(set => region.includes(set));
    }

    let currentQuestionIndex = 0;
    let score = 0;
    let selectedRegions = new Set();
    let hasChecked = false;

    // Venn diagram logic
    const canvas = document.getElementById('vennCanvas');
    const ctx = canvas.getContext('2d');
    const checkBtn = document.getElementById('checkBtn');
    const nextBtn = document.getElementById('nextBtn');
    const resetBtn = document.getElementById('resetBtn');
    const questionText = document.getElementById('question-text');
    const scoreValue = document.getElementById('score-value');
    const feedbackLegend = document.getElementById('feedback-legend');
    const langBMBtn = document.getElementById('langBM');
    const langENGBtn = document.getElementById('langENG');

    // Update language function
    function updateLanguage(lang) {
      currentLanguage = lang;
      const t = translations[lang];
      
      document.getElementById('main-title').textContent = t.title;
      document.getElementById('instruction-text').textContent = t.instruction;
      document.querySelector('.legend h3').textContent = t.universalSet;
      document.getElementById('union-label').textContent = t.union;
      document.getElementById('question-label').textContent = t.question;
      document.getElementById('score-label').textContent = t.score;
      document.getElementById('checkBtn').textContent = t.checkAnswer;
      document.getElementById('nextBtn').textContent = t.nextQuestion;
      document.getElementById('resetBtn').textContent = t.restart;
      document.getElementById('correct-label').textContent = t.correctLabel;
      document.getElementById('wrong-label').textContent = t.wrongLabel;
      document.getElementById('missed-label').textContent = t.missedLabel;
      
      langBMBtn.classList.toggle('active', lang === 'BM');
      langENGBtn.classList.toggle('active', lang === 'ENG');
      
      // Update question text
      questionText.textContent = questions[currentQuestionIndex].text[lang];
    }

    langBMBtn.addEventListener('click', () => updateLanguage('BM'));
    langENGBtn.addEventListener('click', () => updateLanguage('ENG'));

    // Circle positions and radius
    const circles = {
      A: { x: 280, y: 220, r: 120, color: '#f06292' },
      B: { x: 420, y: 220, r: 120, color: '#81c784' },
      C: { x: 350, y: 340, r: 120, color: '#64b5f6' },
      D: { x: 350, y: 370, r: 35, color: '#ba68c8' },
      E: { x: 550, y: 400, r: 60, color: '#ffa726' }
    };

    // Check if a point is inside a circle
    function isInCircle(px, py, circle) {
      const dx = px - circle.x;
      const dy = py - circle.y;
      return (dx * dx + dy * dy) <= (circle.r * circle.r);
    }

    // Determine which region a point belongs to
    function getRegion(x, y) {
      const inA = isInCircle(x, y, circles.A);
      const inB = isInCircle(x, y, circles.B);
      const inC = isInCircle(x, y, circles.C);
      const inD = isInCircle(x, y, circles.D);
      const inE = isInCircle(x, y, circles.E);

      if (inD) {
        if (inA && inB && inC) return 'ABCD';
        if (inA && inC && !inB) return 'ACD';
        if (inB && inC && !inA) return 'BCD';
        if (inC && !inA && !inB) return 'CD';
        return 'D';
      }

      if (inE) return 'E';

      if (inA && inB && inC) return 'ABC';
      if (inA && inB && !inC) return 'AB';
      if (inA && !inB && inC) return 'AC';
      if (!inA && inB && inC) return 'BC';
      if (inA && !inB && !inC) return 'A';
      if (!inA && inB && !inC) return 'B';
      if (!inA && !inB && inC) return 'C';
      return 'outside';
    }

    // Draw the Venn diagram
    function drawVenn() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw universal set boundary
      ctx.strokeStyle = '#dfc4e8';
      ctx.lineWidth = 3;
      ctx.setLineDash([8, 5]);
      ctx.strokeRect(60, 60, 580, 430);
      ctx.setLineDash([]);

      // Draw selected regions
      if (selectedRegions.size > 0 && !hasChecked) {
        const imageData = ctx.createImageData(canvas.width, canvas.height);
        const data = imageData.data;

        for (let y = 0; y < canvas.height; y++) {
          for (let x = 0; x < canvas.width; x++) {
            const region = getRegion(x, y);
            const idx = (y * canvas.width + x) * 4;

            if (selectedRegions.has(region)) {
              data[idx] = 200;
              data[idx + 1] = 200;
              data[idx + 2] = 255;
              data[idx + 3] = 150;
            }
          }
        }

        ctx.putImageData(imageData, 0, 0);
      }

      // Draw feedback after checking
      if (hasChecked) {
        const imageData = ctx.createImageData(canvas.width, canvas.height);
        const data = imageData.data;
        const currentSets = questions[currentQuestionIndex].sets;

        for (let y = 0; y < canvas.height; y++) {
          for (let x = 0; x < canvas.width; x++) {
            const region = getRegion(x, y);
            const idx = (y * canvas.width + x) * 4;

            const isCorrect = region !== 'outside' && regionContainsSets(region, currentSets);
            const wasSelected = selectedRegions.has(region);

            if (isCorrect && wasSelected) {
              // Green - correct and selected
              data[idx] = 76;
              data[idx + 1] = 175;
              data[idx + 2] = 80;
              data[idx + 3] = 180;
            } else if (!isCorrect && wasSelected) {
              // Red - incorrect but selected
              data[idx] = 244;
              data[idx + 1] = 67;
              data[idx + 2] = 54;
              data[idx + 3] = 180;
            } else if (isCorrect && !wasSelected) {
              // Yellow - correct but not selected
              data[idx] = 255;
              data[idx + 1] = 235;
              data[idx + 2] = 59;
              data[idx + 3] = 180;
            }
          }
        }

        ctx.putImageData(imageData, 0, 0);
      }

      // Draw circles
      Object.keys(circles).forEach(key => {
        const circle = circles[key];
        ctx.beginPath();
        ctx.arc(circle.x, circle.y, circle.r, 0, Math.PI * 2);
        ctx.strokeStyle = circle.color;
        ctx.lineWidth = 4;
        ctx.stroke();
      });

      // Draw labels
      ctx.font = '900 32px Poppins, sans-serif';
      ctx.fillStyle = circles.A.color;
      ctx.fillText('A', 200, 150);
      ctx.fillStyle = circles.B.color;
      ctx.fillText('B', 480, 150);
      ctx.fillStyle = circles.C.color;
      ctx.fillText('C', 330, 450);
      
      ctx.font = '900 24px Poppins, sans-serif';
      ctx.fillStyle = circles.D.color;
      ctx.fillText('D', 345, 370);
      
      ctx.font = '900 28px Poppins, sans-serif';
      ctx.fillStyle = circles.E.color;
      ctx.fillText('E', 540, 410);

      ctx.font = '800 28px Georgia, serif';
      ctx.fillStyle = '#b08db5';
      ctx.fillText('ξ', 605, 85);
    }

    // Canvas click handler
    canvas.addEventListener('click', (e) => {
      if (hasChecked) return;

      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      const x = (e.clientX - rect.left) * scaleX;
      const y = (e.clientY - rect.top) * scaleY;

      const region = getRegion(x, y);
      
      if (region !== 'outside') {
        if (selectedRegions.has(region)) {
          selectedRegions.delete(region);
        } else {
          selectedRegions.add(region);
        }
        drawVenn();
      }
    });

    // Check answer
    checkBtn.addEventListener('click', () => {
      if (selectedRegions.size === 0) return;

      hasChecked = true;
      canvas.classList.add('disabled');
      
      const currentSets = questions[currentQuestionIndex].sets;
      
      // Check if all selected regions are correct and no incorrect regions were selected
      let allCorrect = true;
      for (const region of selectedRegions) {
        if (region === 'outside' || !regionContainsSets(region, currentSets)) {
          allCorrect = false;
          break;
        }
      }
      
      // Also check if all correct regions were selected
      const allRegions = ['A', 'B', 'C', 'D', 'E', 'AB', 'AC', 'BC', 'ABC', 'CD', 'ACD', 'BCD', 'ABCD'];
      const correctRegions = allRegions.filter(r => regionContainsSets(r, currentSets));
      
      let allCorrectRegionsSelected = true;
      for (const region of correctRegions) {
        if (!selectedRegions.has(region)) {
          allCorrectRegionsSelected = false;
          break;
        }
      }
      
      const isCorrect = allCorrect && allCorrectRegionsSelected;

      if (isCorrect) {
        score++;
      }

      feedbackLegend.style.display = 'flex';
      scoreValue.textContent = `${score} / 15`;
      
      checkBtn.style.display = 'none';
      nextBtn.style.display = 'block';
      
      drawVenn();
    });

    // Next question
    nextBtn.addEventListener('click', () => {
      currentQuestionIndex++;
      
      if (currentQuestionIndex >= questions.length) {
        // Game complete
        nextBtn.disabled = true;
        return;
      }

      // Reset for next question
      selectedRegions.clear();
      hasChecked = false;
      canvas.classList.remove('disabled');
      feedbackLegend.style.display = 'none';
      
      questionText.textContent = questions[currentQuestionIndex].text[currentLanguage];
      
      checkBtn.style.display = 'block';
      nextBtn.style.display = 'none';
      
      drawVenn();
    });

    // Reset game
    resetBtn.addEventListener('click', () => {
      currentQuestionIndex = 0;
      score = 0;
      selectedRegions.clear();
      hasChecked = false;
      canvas.classList.remove('disabled');
      
      scoreValue.textContent = '0 / 15';
      questionText.textContent = questions[0].text[currentLanguage];
      feedbackLegend.style.display = 'none';
      
      checkBtn.style.display = 'block';
      nextBtn.style.display = 'none';
      nextBtn.disabled = false;
      
      drawVenn();
    });

    // Initial draw
    drawVenn();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9aa9272c25bcdac0',t:'MTc2NTE2NDMwMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
