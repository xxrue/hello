<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sumber Moral - Permainan Interaktif</title>
    <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            color: #334155;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(99, 102, 241, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .title {
            text-align: center;
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 700;
            margin-bottom: 40px;
            color: #475569;
            letter-spacing: 1px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 20px;
            background: rgba(255, 255, 255, 0.8);
            padding: 25px 35px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(226, 232, 240, 0.8);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .progress-container {
            flex: 1;
            min-width: 250px;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            width: 0%;
            transition: width 0.8s ease;
            border-radius: 12px;
        }

        .score {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            color: #475569;
            padding: 20px 30px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 1.2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #cbd5e1;
            transition: all 0.3s ease;
        }

        .stage {
            display: none;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: clamp(30px, 4vw, 50px);
            margin: 30px 0;
            box-shadow: 0 4px 25px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(226, 232, 240, 0.8);
            backdrop-filter: blur(10px);
            transition: all 0.4s ease;
        }

        .stage.active {
            display: block;
            animation: stageSlideIn 0.5s ease-out;
        }

        @keyframes stageSlideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stage-title {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            color: #334155;
            text-align: center;
            margin-bottom: 35px;
            font-weight: 600;
            letter-spacing: 0.5px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        /* Stage 1 Styles */
        .categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .category {
            min-height: 350px;
            border: 2px dashed #cbd5e1;
            border-radius: 16px;
            padding: 35px;
            text-align: center;
            transition: all 0.3s ease;
            background: #f8fafc;
            position: relative;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .category.drag-over {
            border-color: #6366f1;
            background: #eef2ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.15);
        }

        .category h3 {
            color: #475569;
            font-size: clamp(1.4rem, 3vw, 1.8rem);
            margin-bottom: 30px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        .dropped-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 180px;
        }

        .items-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .draggable-item {
            background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
            color: #475569;
            padding: 20px 25px;
            border-radius: 12px;
            cursor: grab;
            user-select: none;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            text-align: center;
            font-size: 1rem;
            border: 1px solid #cbd5e1;
        }

        .draggable-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.12);
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
        }

        .draggable-item.dragging {
            opacity: 0.7;
            transform: rotate(2deg) scale(1.02);
            z-index: 1000;
        }

        .dropped-item {
            background: linear-gradient(135deg, #ddd6fe, #c4b5fd);
            color: #5b21b6;
            padding: 18px 22px;
            border-radius: 12px;
            font-weight: 500;
            animation: dropSuccess 0.4s ease-out;
            font-size: 0.95rem;
            cursor: grab;
            user-select: none;
            transition: all 0.3s ease;
            border: 1px solid #c4b5fd;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.15);
        }

        @keyframes dropSuccess {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .dropped-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.2);
        }

        .dropped-item.correct {
            background: linear-gradient(135deg, #bbf7d0, #86efac);
            color: #166534;
            border-color: #86efac;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.2);
        }

        .dropped-item.incorrect {
            background: linear-gradient(135deg, #fecaca, #fca5a5);
            color: #991b1b;
            border-color: #fca5a5;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.2);
        }

        /* Stage 2 Styles - Word Scramble */
        .word-scramble-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .scramble-words {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .word-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .word-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.12);
        }

        .word-title {
            color: #6366f1;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .scrambled-letters {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .letter-tile {
            background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
            color: #475569;
            width: 42px;
            height: 42px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #cbd5e1;
        }

        .letter-tile:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
        }

        .letter-tile.selected {
            background: linear-gradient(135deg, #ddd6fe, #c4b5fd);
            color: #5b21b6;
            transform: translateY(-3px) scale(1.08);
            border-color: #c4b5fd;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.25);
        }

        .answer-area {
            min-height: 60px;
            background: #f8fafc;
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            flex-wrap: wrap;
            transition: all 0.3s ease;
        }

        .answer-area.has-letters {
            border-color: #6366f1;
            background: #eef2ff;
        }

        .word-status {
            font-size: 1.1rem;
            font-weight: 700;
            margin-top: 10px;
            min-height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .word-status.correct {
            color: #059669;
            background: #d1fae5;
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid #86efac;
        }

        /* Stage 3 Styles */
        .sorting-container {
            text-align: center;
            max-width: 700px;
            margin: 0 auto;
        }

        .rukun-items {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 40px;
        }

        .rukun-item {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
            padding: 25px;
            border-radius: 20px;
            cursor: grab;
            user-select: none;
            font-weight: 700;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 10px 30px rgba(162, 155, 254, 0.4);
            border: 3px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            animation: rukunFloat 5s ease-in-out infinite;
        }

        @keyframes rukunFloat {
            0%, 100% { transform: translateX(0px); }
            25% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
        }

        .rukun-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }

        .rukun-item:hover::before {
            left: 100%;
        }

        .rukun-item:hover {
            transform: translateX(15px) scale(1.03);
            box-shadow: 0 15px 40px rgba(162, 155, 254, 0.6);
            animation: none;
        }

        .rukun-item.correct-position {
            background: linear-gradient(135deg, #00d4aa, #00b894);
            animation: correctRukun 1s ease;
            box-shadow: 0 0 40px rgba(0, 212, 170, 0.8);
        }

        @keyframes correctRukun {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.05) rotate(1deg); }
            50% { transform: scale(0.98) rotate(-1deg); }
            75% { transform: scale(1.02) rotate(0.5deg); }
        }

        .drag-handle {
            background: rgba(255,255,255,0.25);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.8rem;
            backdrop-filter: blur(10px);
            color: rgba(255,255,255,0.9);
            cursor: grab;
            transition: all 0.3s ease;
            animation: handleSpin 4s linear infinite;
        }

        @keyframes handleSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .drag-handle:hover {
            background: rgba(255,255,255,0.4);
            transform: scale(1.1);
            animation: none;
        }

        .btn {
            background: linear-gradient(135deg, #ff6b9d, #c44569);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 30px;
            font-size: 1.2rem;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 15px;
            box-shadow: 0 10px 30px rgba(196, 69, 105, 0.4);
            border: 3px solid rgba(255, 255, 255, 0.3);
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 40px rgba(196, 69, 105, 0.6);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn.restart {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }

        .btn.restart:hover {
            box-shadow: 0 15px 40px rgba(116, 185, 255, 0.6);
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #2c3e50;
            padding: 40px 50px;
            border-radius: 20px;
            text-align: center;
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            font-weight: 700;
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.3);
            z-index: 2000;
            animation: celebrationSlide 0.6s ease-out;
            display: none;
            border: 2px solid rgba(255, 255, 255, 0.5);
            max-width: 500px;
            width: 90%;
        }

        @keyframes celebrationSlide {
            0% { transform: translate(-50%, -60px); opacity: 0; }
            100% { transform: translate(-50%, -50%); opacity: 1; }
        }

        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            animation: confettiFall 5s linear infinite;
        }

        @keyframes confettiFall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(1080deg); opacity: 0; }
        }

        .game-instructions {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px 35px;
            border-radius: 25px;
            margin-bottom: 40px;
            border-left: 6px solid #ffd700;
            font-size: 1.2rem;
            color: #2d3748;
            font-weight: 600;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            border: 3px solid rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(15px);
            animation: instructionsGlow 3s ease-in-out infinite alternate;
        }

        @keyframes instructionsGlow {
            0% { box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); }
            100% { box-shadow: 0 15px 35px rgba(255, 215, 0, 0.3); }
        }

        /* Score Reveal Styles */
        .score-reveal-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 500px;
        }

        .final-score-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 50px;
            border-radius: 35px;
            text-align: center;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.3);
            border: 3px solid rgba(255, 255, 255, 0.3);
            max-width: 600px;
            width: 100%;
            backdrop-filter: blur(20px);
            animation: finalCardFloat 4s ease-in-out infinite;
        }

        @keyframes finalCardFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .score-icon {
            font-size: 5rem;
            margin-bottom: 25px;
            animation: scoreIconSpin 3s ease-in-out infinite;
        }

        @keyframes scoreIconSpin {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(180deg); }
        }

        .final-score-card h3 {
            font-size: 2.5rem;
            color: #1e293b;
            margin-bottom: 25px;
            font-family: 'Georgia', serif;
            text-shadow: none;
            font-weight: 700;
        }

        .final-score-number {
            font-size: 5rem;
            font-weight: 900;
            color: #ffd700;
            margin-bottom: 35px;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
            animation: finalScorePulse 2s ease-in-out infinite alternate;
        }

        @keyframes finalScorePulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }

        .score-breakdown {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            font-weight: 700;
            color: #fff;
            font-size: 1.1rem;
        }

        .performance-message {
            font-size: 1.4rem;
            color: #00d4aa;
            font-weight: 700;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 212, 170, 0.2);
            border-radius: 15px;
            animation: messageGlow 2s ease-in-out infinite alternate;
        }

        @keyframes messageGlow {
            0% { box-shadow: 0 0 20px rgba(0, 212, 170, 0.3); }
            100% { box-shadow: 0 0 30px rgba(0, 212, 170, 0.6); }
        }

        /* Stage Complete Modal */
        .stage-complete-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(147, 51, 234, 0.9));
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            backdrop-filter: blur(15px);
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.15);
            padding: 50px;
            border-radius: 30px;
            text-align: center;
            box-shadow: 0 30px 70px rgba(0, 0, 0, 0.4);
            border: 3px solid rgba(255, 255, 255, 0.3);
            max-width: 500px;
            width: 90%;
            animation: modalSlideIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-80px) scale(0.8); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .modal-content h3 {
            font-size: 2.2rem;
            color: #fff;
            margin-bottom: 20px;
            font-family: 'Georgia', serif;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .modal-content p {
            font-size: 1.3rem;
            color: #fff;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .modal-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .container { padding: 15px; }
            .game-header { flex-direction: column; }
            .categories { grid-template-columns: 1fr; }
            .items-container { grid-template-columns: 1fr; }
            .scramble-words { grid-template-columns: 1fr; }
            .stage { padding: 25px; }
        }

        @media (max-width: 480px) {
            .btn { padding: 15px 25px; font-size: 1rem; }
            .letter-tile { width: 40px; height: 40px; font-size: 1rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">üåü SUMBER MORAL üåü</h1>
        
        <div class="game-header">
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            <div class="score">
                Skor: <span id="score">0</span> ‚≠ê
            </div>
        </div>

        <!-- Stage 1: Drag and Drop -->
        <div class="stage active" id="stage1">
            <h2 class="stage-title">üéØ Tahap 1: Kategorikan Sumber Moral</h2>
            <div class="game-instructions">
                üìù <strong>Arahan:</strong> Seret setiap item ke kategori yang betul - Agama atau Kepercayaan!<br>
                üí° <strong>Cara main:</strong> Klik dan seret item ‚Üí Lepaskan di kategori yang sesuai<br>
                üîÑ <strong>Untuk ubah:</strong> Seret semula item ke kategori lain atau kembali ke bawah
            </div>
            
            <div class="categories">
                <div class="category" data-category="agama">
                    <h3>üïå AGAMA</h3>
                    <div class="dropped-items"></div>
                </div>
                <div class="category" data-category="kepercayaan">
                    <h3>üôè KEPERCAYAAN</h3>
                    <div class="dropped-items"></div>
                </div>
            </div>

            <div class="items-container" id="itemsContainer">
                <div class="draggable-item" data-category="agama" draggable="true">Islam (Al-Quran)</div>
                <div class="draggable-item" data-category="kepercayaan" draggable="true">Confucius (Lun Yu)</div>
                <div class="draggable-item" data-category="agama" draggable="true">Kristian (Bible)</div>
                <div class="draggable-item" data-category="kepercayaan" draggable="true">Taoisme (Tao Te Ching)</div>
                <div class="draggable-item" data-category="agama" draggable="true">Buddha (Tripitaka)</div>
                <div class="draggable-item" data-category="kepercayaan" draggable="true">Kepercayaan Orang Asli</div>
                <div class="draggable-item" data-category="agama" draggable="true">Hindu (Bhagavad Gita)</div>
                <div class="draggable-item" data-category="agama" draggable="true">Sikh (Sri Guru Granth Sahib)</div>
                <div class="draggable-item" data-category="kepercayaan" draggable="true">Kepercayaan Pribumi Sabah & Sarawak</div>
            </div>

            <div style="text-align: center;">
                <button class="btn" id="checkStage1">Semak Jawapan</button>
                <button class="btn restart" id="restartStage1">Set Semula</button>
            </div>
        </div>

        <!-- Stage 2: Word Scramble -->
        <div class="stage" id="stage2">
            <h2 class="stage-title">üî§ Tahap 2: Susun Huruf Norma Masyarakat</h2>
            <div class="game-instructions">
                üß© <strong>Arahan:</strong> Susun huruf-huruf untuk membentuk perkataan berkaitan Norma Masyarakat!<br>
                üí° <strong>Cara main:</strong> Klik huruf mengikut urutan yang betul ‚Üí Huruf akan tersusun di kotak jawapan<br>
                üîÑ <strong>Untuk ubah:</strong> Klik huruf yang sudah dipilih untuk batalkan pilihan<br>
                ‚è≠Ô∏è <strong>Nota:</strong> Selesaikan satu perkataan sebelum ke perkataan seterusnya
            </div>
            
            <div class="word-scramble-container">
                <div class="scramble-words" id="scrambleWords">
                    <!-- Word cards will be populated by JavaScript -->
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" id="checkWords">Semak Jawapan</button>
                    <button class="btn restart" id="resetWords">Set Semula</button>
                </div>
            </div>
        </div>

        <!-- Stage 3: Rukun Negara Sorting -->
        <div class="stage" id="stage3">
            <h2 class="stage-title">üèÜ Tahap 3: Susun Rukun Negara</h2>
            <div class="game-instructions">
                üî¢ <strong>Arahan:</strong> Susun Rukun Negara mengikut urutan yang betul (1-5)!<br>
                üí° <strong>Cara main:</strong> Seret item menggunakan ikon ‚ãÆ‚ãÆ ‚Üí Susun dari atas ke bawah<br>
                üîÑ <strong>Untuk ubah:</strong> Seret semula item ke kedudukan yang diingini<br>
                ‚úÖ <strong>Petua:</strong> Item akan bertukar warna hijau apabila berada di kedudukan yang betul
            </div>
            
            <div class="sorting-container">
                <div class="rukun-items" id="rukunItems">
                    <div class="rukun-item" data-order="5">
                        <span>Kesopanan dan Kesusilaan</span>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                    <div class="rukun-item" data-order="1">
                        <span>Kepercayaan kepada Tuhan</span>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                    <div class="rukun-item" data-order="3">
                        <span>Keluhuran Perlembagaan</span>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                    <div class="rukun-item" data-order="4">
                        <span>Kedaulatan Undang-Undang</span>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                    <div class="rukun-item" data-order="2">
                        <span>Kesetiaan kepada Raja dan Negara</span>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                </div>
                <div style="text-align: center;">
                    <button class="btn" id="checkOrder">Semak Susunan</button>
                    <button class="btn restart" id="shuffleItems">Kacau Semula</button>
                </div>
            </div>
        </div>

        <!-- Score Reveal Page -->
        <div class="stage" id="scoreReveal">
            <h2 class="stage-title">üèÜ Keputusan Akhir</h2>
            
            <div class="score-reveal-container">
                <div class="final-score-card">
                    <div class="score-icon">üåü</div>
                    <h3>Skor Akhir Anda</h3>
                    <div class="final-score-number" id="finalScoreNumber">0</div>
                    <div class="score-breakdown">
                        <div class="breakdown-item">
                            <span>Tahap 1 - Kategorikan:</span>
                            <span id="stage1Points">0 mata</span>
                        </div>
                        <div class="breakdown-item">
                            <span>Tahap 2 - Susun Huruf:</span>
                            <span id="stage2Points">0 mata</span>
                        </div>
                        <div class="breakdown-item">
                            <span>Tahap 3 - Rukun Negara:</span>
                            <span id="stage3Points">0 mata</span>
                        </div>
                    </div>
                    <div class="performance-message" id="performanceMessage">
                        Tahniah! Anda telah menyelesaikan semua tahap!
                    </div>
                    <button class="btn" id="playAgain">Main Lagi</button>
                </div>
            </div>
        </div>

        <!-- Stage Completion Modal -->
        <div class="stage-complete-modal" id="stageCompleteModal">
            <div class="modal-content">
                <h3 id="modalTitle">Tahap Selesai!</h3>
                <p id="modalMessage">Anda telah berjaya menyelesaikan tahap ini!</p>
                <div class="modal-buttons">
                    <button class="btn" id="continueBtn">Tahap Seterusnya</button>
                    <button class="btn restart" id="viewScoreBtn">Main Semula</button>
                </div>
            </div>
        </div>

        <div class="celebration" id="celebration">
            üéâ Tahniah! Anda telah berjaya! üéâ
        </div>
    </div>

    <script>
        let currentStage = 1;
        let score = 0;
        let stage1Complete = false;
        let stage2Complete = false;
        let stage3Complete = false;
        let stage1Checked = false;
        let stageScores = { stage1: 0, stage2: 0, stage3: 0 };

        // Word scramble data for Stage 2
        const baseWords = [
            "PERATURAN",
            "UNDANG-UNDANG", 
            "PANTANG LARANG",
            "ADAT RESAM MASYARAKAT"
        ];

        let scrambleWords = [];

        function generateScrambledWords() {
            scrambleWords = baseWords.map(word => {
                // Create array of characters
                let chars = word.split('');
                
                // Shuffle the characters randomly
                for (let i = chars.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [chars[i], chars[j]] = [chars[j], chars[i]];
                }
                
                // Make sure it's actually scrambled (not the same as original)
                let scrambled = chars.join('');
                let attempts = 0;
                while (scrambled === word && attempts < 10) {
                    for (let i = chars.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [chars[i], chars[j]] = [chars[j], chars[i]];
                    }
                    scrambled = chars.join('');
                    attempts++;
                }
                
                return { word: word, scrambled: scrambled };
            });
        }

        let wordStates = {};

        // Stage 1: Enhanced Drag and Drop functionality
        let draggedItem = null;
        let draggedFromContainer = null;

        function initializeDragAndDrop() {
            const allContainers = document.querySelectorAll('.category, #itemsContainer');
            
            allContainers.forEach(container => {
                container.addEventListener('dragover', handleDragOver);
                container.addEventListener('drop', handleDrop);
                container.addEventListener('dragenter', handleDragEnter);
                container.addEventListener('dragleave', handleDragLeave);
            });

            updateAllItemsEventListeners();
        }

        function updateAllItemsEventListeners() {
            const allItems = document.querySelectorAll('.draggable-item, .dropped-item');
            allItems.forEach(item => {
                item.removeEventListener('dragstart', handleItemDragStart);
                item.removeEventListener('dragend', handleItemDragEnd);
                
                item.addEventListener('dragstart', handleItemDragStart);
                item.addEventListener('dragend', handleItemDragEnd);
                item.draggable = !stage1Checked;
                
                if (!stage1Checked) {
                    item.style.cursor = 'grab';
                } else {
                    item.style.cursor = 'default';
                }
            });
        }

        function handleItemDragStart(e) {
            if (stage1Checked) return false;
            
            draggedItem = this;
            draggedFromContainer = this.parentElement;
            
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.outerHTML);
            
            e.dataTransfer.setData('item-text', this.textContent);
            e.dataTransfer.setData('item-category', this.dataset.category || this.dataset.originalCategory);
        }

        function handleItemDragEnd(e) {
            this.classList.remove('dragging');
            
            document.querySelectorAll('.drag-over').forEach(el => {
                el.classList.remove('drag-over');
            });
            
            draggedItem = null;
            draggedFromContainer = null;
        }

        function handleDragOver(e) {
            if (stage1Checked || !draggedItem) return;
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDragEnter(e) {
            if (stage1Checked || !draggedItem) return;
            e.preventDefault();
            
            if (this.classList.contains('category') || this.id === 'itemsContainer') {
                this.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            if (!this.contains(e.relatedTarget)) {
                this.classList.remove('drag-over');
            }
        }

        function handleDrop(e) {
            if (stage1Checked || !draggedItem) return;
            
            e.preventDefault();
            this.classList.remove('drag-over');
            
            const itemText = e.dataTransfer.getData('item-text');
            const itemCategory = e.dataTransfer.getData('item-category');
            
            if (this === draggedFromContainer) return;
            
            const newItem = document.createElement('div');
            newItem.textContent = itemText;
            newItem.draggable = true;
            
            if (this.classList.contains('category')) {
                newItem.className = 'dropped-item';
                newItem.dataset.originalCategory = itemCategory;
                newItem.dataset.targetCategory = this.dataset.category;
                
                const droppedItems = this.querySelector('.dropped-items');
                droppedItems.appendChild(newItem);
            } else if (this.id === 'itemsContainer') {
                newItem.className = 'draggable-item';
                newItem.dataset.category = itemCategory;
                this.appendChild(newItem);
            }
            
            if (draggedItem && draggedItem.parentElement) {
                draggedItem.remove();
            }
            
            updateAllItemsEventListeners();
        }

        document.getElementById('checkStage1').addEventListener('click', checkStage1Answers);
        document.getElementById('restartStage1').addEventListener('click', restartStage1);
        
        initializeDragAndDrop();

        function checkStage1Answers() {
            if (stage1Checked) return;
            
            stage1Checked = true;
            let correctCount = 0;
            let totalCount = 0;
            
            updateAllItemsEventListeners();
            
            const droppedItems = document.querySelectorAll('.dropped-item');
            droppedItems.forEach(item => {
                totalCount++;
                const isCorrect = item.dataset.originalCategory === item.dataset.targetCategory;
                
                if (isCorrect) {
                    item.classList.add('correct');
                    correctCount++;
                } else {
                    item.classList.add('incorrect');
                }
            });
            
            const points = correctCount * 10;
            updateScore(points);
            stageScores.stage1 = points;
            
            const percentage = Math.round((correctCount / totalCount) * 100);
            showCelebration(`Keputusan: ${correctCount}/${totalCount} betul (${percentage}%)`);
            
            document.getElementById('checkStage1').style.display = 'none';
            
            if (correctCount === totalCount) {
                setTimeout(() => {
                    stage1Complete = true;
                    showStageCompleteModal('Tahap 1 Selesai!', `Anda berjaya kategorikan semua item dengan betul! Skor: ${correctCount}/${totalCount}`);
                }, 2000);
            }
        }

        function restartStage1() {
            stage1Checked = false;
            
            const droppedContainers = document.querySelectorAll('.dropped-items');
            droppedContainers.forEach(container => {
                container.innerHTML = '';
            });
            
            const originalItems = [
                { text: "Islam (Al-Quran)", category: "agama" },
                { text: "Kristian (Bible)", category: "agama" },
                { text: "Buddha (Tripitaka)", category: "agama" },
                { text: "Hindu (Bhagavad Gita)", category: "agama" },
                { text: "Sikh (Sri Guru Granth Sahib)", category: "agama" },
                { text: "Confucius (Lun Yu)", category: "kepercayaan" },
                { text: "Taoisme (Tao Te Ching)", category: "kepercayaan" },
                { text: "Kepercayaan Orang Asli", category: "kepercayaan" },
                { text: "Kepercayaan Pribumi Sabah & Sarawak", category: "kepercayaan" }
            ];
            
            // Shuffle the items randomly
            for (let i = originalItems.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [originalItems[i], originalItems[j]] = [originalItems[j], originalItems[i]];
            }
            
            const itemsContainer = document.getElementById('itemsContainer');
            itemsContainer.innerHTML = '';
            
            originalItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'draggable-item';
                div.setAttribute('data-category', item.category);
                div.setAttribute('draggable', 'true');
                div.textContent = item.text;
                itemsContainer.appendChild(div);
            });
            
            updateAllItemsEventListeners();
            
            document.getElementById('checkStage1').style.display = 'inline-block';
            document.getElementById('restartStage1').style.display = 'none';
        }

        // Initialize Stage 1 with random order
        function initializeStage1() {
            restartStage1();
        }

        // Stage 2: Word Scramble functionality - One by one
        let currentWordIndex = 0;
        let stage2WordsCompleted = 0;

        function setupStage2() {
            // Generate new scrambled words each time
            generateScrambledWords();
            
            const scrambleContainer = document.getElementById('scrambleWords');
            scrambleContainer.innerHTML = '';
            wordStates = {};
            currentWordIndex = 0;
            stage2WordsCompleted = 0;
            
            // Initialize all word states
            scrambleWords.forEach((wordData, index) => {
                wordStates[index] = {
                    selectedLetters: [],
                    isComplete: false
                };
            });
            
            // Show first word
            showCurrentWord();
            
            document.getElementById('checkWords').addEventListener('click', checkCurrentWord);
            document.getElementById('resetWords').addEventListener('click', resetCurrentWord);
        }

        function showCurrentWord() {
            const scrambleContainer = document.getElementById('scrambleWords');
            const wordData = scrambleWords[currentWordIndex];
            
            scrambleContainer.innerHTML = `
                <div class="word-card">
                    <div class="word-title">Perkataan ${currentWordIndex + 1} daripada ${scrambleWords.length}</div>
                    <div class="scrambled-letters" data-word-index="${currentWordIndex}">
                        ${wordData.scrambled.split('').map(letter => 
                            `<div class="letter-tile" data-letter="${letter}">${letter}</div>`
                        ).join('')}
                    </div>
                    <div class="answer-area" data-word-index="${currentWordIndex}"></div>
                    <div class="word-status" data-word-index="${currentWordIndex}"></div>
                </div>
            `;
            
            // Add event listeners to letter tiles
            document.querySelectorAll('.letter-tile').forEach(tile => {
                tile.addEventListener('click', handleLetterClick);
            });
        }

        function handleLetterClick(e) {
            const tile = e.target;
            const wordIndex = parseInt(tile.closest('.scrambled-letters').dataset.wordIndex);
            const letter = tile.dataset.letter;
            
            if (tile.classList.contains('selected')) {
                // Remove letter from answer
                tile.classList.remove('selected');
                const letterIndex = wordStates[wordIndex].selectedLetters.indexOf(letter);
                if (letterIndex > -1) {
                    wordStates[wordIndex].selectedLetters.splice(letterIndex, 1);
                }
            } else {
                // Add letter to answer
                tile.classList.add('selected');
                wordStates[wordIndex].selectedLetters.push(letter);
            }
            
            updateAnswerArea(wordIndex);
        }

        function updateAnswerArea(wordIndex) {
            const answerArea = document.querySelector(`[data-word-index="${wordIndex}"].answer-area`);
            const selectedLetters = wordStates[wordIndex].selectedLetters;
            
            answerArea.innerHTML = selectedLetters.map(letter => 
                `<div class="letter-tile selected">${letter}</div>`
            ).join('');
            
            if (selectedLetters.length > 0) {
                answerArea.classList.add('has-letters');
            } else {
                answerArea.classList.remove('has-letters');
            }
        }

        function checkCurrentWord() {
            const wordData = scrambleWords[currentWordIndex];
            const userAnswer = wordStates[currentWordIndex].selectedLetters.join('');
            const correctAnswer = wordData.word;
            const statusElement = document.querySelector(`[data-word-index="${currentWordIndex}"].word-status`);
            
            if (userAnswer === correctAnswer) {
                statusElement.textContent = `‚úÖ Betul! ${correctAnswer}`;
                statusElement.classList.add('correct');
                wordStates[currentWordIndex].isComplete = true;
                updateScore(25);
                stageScores.stage2 += 25;
                stage2WordsCompleted++;
                
                // Check if this was the last word
                if (stage2WordsCompleted === scrambleWords.length) {
                    setTimeout(() => {
                        stage2Complete = true;
                        showStageCompleteModal('Tahap 2 Selesai!', `Anda berjaya susun semua ${scrambleWords.length} perkataan dengan betul!`);
                    }, 1500);
                } else {
                    // Show next word after a delay
                    setTimeout(() => {
                        currentWordIndex++;
                        showCurrentWord();
                    }, 2000);
                }
            } else {
                statusElement.textContent = `‚ùå Cuba lagi! Susun semula huruf-huruf.`;
                statusElement.classList.remove('correct');
            }
        }

        function resetCurrentWord() {
            // Reset current word state
            wordStates[currentWordIndex] = {
                selectedLetters: [],
                isComplete: false
            };
            
            // Clear UI
            document.querySelectorAll('.letter-tile').forEach(tile => {
                tile.classList.remove('selected');
            });
            
            const answerArea = document.querySelector(`[data-word-index="${currentWordIndex}"].answer-area`);
            answerArea.innerHTML = '';
            answerArea.classList.remove('has-letters');
            
            const statusElement = document.querySelector(`[data-word-index="${currentWordIndex}"].word-status`);
            statusElement.textContent = '';
            statusElement.classList.remove('correct');
        }

        // Stage 3: Rukun Negara sorting
        let draggedElement = null;

        function setupStage3() {
            const rukunItems = document.querySelectorAll('.rukun-item');
            
            rukunItems.forEach(item => {
                item.addEventListener('dragstart', handleRukunDragStart);
                item.addEventListener('dragover', handleRukunDragOver);
                item.addEventListener('drop', handleRukunDrop);
                item.addEventListener('dragend', handleRukunDragEnd);
                item.draggable = true;
            });

            document.getElementById('checkOrder').addEventListener('click', checkRukunOrder);
            document.getElementById('shuffleItems').addEventListener('click', shuffleRukunItems);
        }

        function handleRukunDragStart(e) {
            draggedElement = this;
            this.style.opacity = '0.5';
        }

        function handleRukunDragOver(e) {
            e.preventDefault();
        }

        function handleRukunDrop(e) {
            e.preventDefault();
            if (this !== draggedElement) {
                const container = this.parentNode;
                const draggedIndex = Array.from(container.children).indexOf(draggedElement);
                const targetIndex = Array.from(container.children).indexOf(this);
                
                if (draggedIndex < targetIndex) {
                    container.insertBefore(draggedElement, this.nextSibling);
                } else {
                    container.insertBefore(draggedElement, this);
                }
            }
        }

        function handleRukunDragEnd(e) {
            this.style.opacity = '1';
            draggedElement = null;
        }

        function checkRukunOrder() {
            const items = document.querySelectorAll('.rukun-item');
            let correct = true;
            
            items.forEach((item, index) => {
                const expectedOrder = index + 1;
                const actualOrder = parseInt(item.dataset.order);
                
                if (actualOrder === expectedOrder) {
                    item.classList.add('correct-position');
                } else {
                    item.classList.remove('correct-position');
                    correct = false;
                }
            });
            
            if (correct) {
                updateScore(50);
                stageScores.stage3 = 50;
                stage3Complete = true;
                createConfetti();
                setTimeout(() => {
                    showStageCompleteModal('Semua Tahap Selesai!', 'Tahniah! Anda telah berjaya menyusun Rukun Negara dengan betul!');
                }, 1000);
            } else {
                showCelebration('Cuba lagi! Susunan belum betul. ü§î');
            }
        }

        function shuffleRukunItems() {
            const container = document.getElementById('rukunItems');
            const items = Array.from(container.children);
            
            items.forEach(item => item.classList.remove('correct-position'));
            
            // Shuffle multiple times for better randomization
            for (let shuffle = 0; shuffle < 3; shuffle++) {
                for (let i = items.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [items[i], items[j]] = [items[j], items[i]];
                }
            }
            
            // Clear container and re-add shuffled items
            container.innerHTML = '';
            items.forEach(item => container.appendChild(item));
        }

        // Utility functions
        function updateScore(points) {
            score += points;
            document.getElementById('score').textContent = score;
        }

        function updateProgress() {
            const progress = (currentStage - 1) * 33.33;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function showStageCompleteModal(title, message) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('stageCompleteModal').style.display = 'flex';
            
            // Update button text based on stage
            const continueBtn = document.getElementById('continueBtn');
            const viewScoreBtn = document.getElementById('viewScoreBtn');
            
            if (currentStage < 3) {
                continueBtn.textContent = 'Tahap Seterusnya';
                viewScoreBtn.textContent = 'Main Semula';
                
                continueBtn.onclick = () => {
                    document.getElementById('stageCompleteModal').style.display = 'none';
                    nextStage();
                };
                
                viewScoreBtn.onclick = () => {
                    document.getElementById('stageCompleteModal').style.display = 'none';
                    location.reload();
                };
            } else {
                continueBtn.textContent = 'Lihat Skor';
                viewScoreBtn.textContent = 'Main Semula';
                
                continueBtn.onclick = () => {
                    document.getElementById('stageCompleteModal').style.display = 'none';
                    showScoreReveal();
                };
                
                viewScoreBtn.onclick = () => {
                    document.getElementById('stageCompleteModal').style.display = 'none';
                    location.reload();
                };
            }
        }

        function nextStage() {
            document.querySelector('.stage.active').classList.remove('active');
            currentStage++;
            
            if (currentStage <= 3) {
                document.getElementById(`stage${currentStage}`).classList.add('active');
                updateProgress();
                
                if (currentStage === 2) {
                    setupStage2();
                } else if (currentStage === 3) {
                    setupStage3();
                    shuffleRukunItems();
                }
            }
        }

        function showScoreReveal() {
            document.querySelector('.stage.active').classList.remove('active');
            document.getElementById('scoreReveal').classList.add('active');
            
            document.getElementById('finalScoreNumber').textContent = score;
            document.getElementById('stage1Points').textContent = `${stageScores.stage1} mata`;
            document.getElementById('stage2Points').textContent = `${stageScores.stage2} mata`;
            document.getElementById('stage3Points').textContent = `${stageScores.stage3} mata`;
            
            let message = '';
            if (score >= 300) {
                message = 'üèÜ Cemerlang! Anda seorang pakar Sumber Moral!';
            } else if (score >= 250) {
                message = 'üåü Bagus sekali! Pengetahuan anda sangat baik!';
            } else if (score >= 200) {
                message = 'üëç Baik! Teruskan usaha untuk lebih baik!';
            } else {
                message = 'üí™ Cuba lagi untuk meningkatkan skor anda!';
            }
            document.getElementById('performanceMessage').textContent = message;
            
            document.getElementById('playAgain').onclick = () => {
                location.reload();
            };
        }

        function showCelebration(message) {
            const celebration = document.getElementById('celebration');
            celebration.textContent = message;
            celebration.style.display = 'block';
            
            setTimeout(() => {
                celebration.style.display = 'none';
            }, 3000);
        }

        function createConfetti() {
            for (let i = 0; i < 80; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = ['#ffd700', '#ff6b9d', '#74b9ff', '#00d4aa', '#a29bfe'][Math.floor(Math.random() * 5)];
                    confetti.style.animationDelay = Math.random() * 2 + 's';
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 5000);
                }, i * 30);
            }
        }

        // Initialize
        updateProgress();
        initializeStage1();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9850b379a1626312',t:'MTc1ODg2ODEwNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
