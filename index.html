<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bola Baling - Permainan Interaktif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        @keyframes fallDown {
            0% { 
                transform: translateY(-50px) scale(1);
                opacity: 1;
            }
            100% { 
                transform: translateY(400px) scale(0.8);
                opacity: 0.8;
            }
        }
        
        @keyframes playerMove {
            0% { transform: translateX(var(--start-x)) translateY(0); }
            100% { transform: translateX(var(--end-x)) translateY(0); }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        @keyframes flipCard {
            0% { transform: rotateY(0deg); }
            50% { transform: rotateY(90deg); }
            100% { transform: rotateY(0deg); }
        }
        
        @keyframes shuffle {
            0%, 100% { transform: translateX(0) translateY(0); }
            25% { transform: translateX(20px) translateY(-10px); }
            50% { transform: translateX(-15px) translateY(10px); }
            75% { transform: translateX(10px) translateY(-5px); }
        }
        
        .falling-ball {
            animation: fallDown var(--fall-speed, 2s) linear forwards;
        }
        
        .player-moving {
            animation: playerMove 0.3s ease-out forwards;
        }
        
        .bounce { animation: bounce 2s infinite; }
        .flip-card { animation: flipCard 0.6s ease-in-out; }
        .shuffle-animation { animation: shuffle 1s ease-in-out; }
        
        .court-bg {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            position: relative;
        }
        
        .court-lines {
            background-image: 
                linear-gradient(90deg, rgba(255,255,255,0.3) 1px, transparent 1px),
                linear-gradient(rgba(255,255,255,0.3) 1px, transparent 1px);
            background-size: 40px 40px;
        }
        
        .ball {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            cursor: pointer;
        }
        
        .goal-net {
            width: 60px;
            height: 80px;
        }
        
        .card {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 12px;
            aspect-ratio: 3/4;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        
        .card-back {
            background: linear-gradient(135deg, #6366f1, #4338ca);
        }
        
        .aiming-line {
            position: absolute;
            width: 2px;
            background: linear-gradient(to top, #fbbf24, transparent);
            transform-origin: bottom;
            pointer-events: none;
            opacity: 0.8;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-400 via-purple-500 to-pink-500 min-h-full">
    <div class="container mx-auto px-4 py-6 max-w-md lg:max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-4xl font-bold text-white mb-2 drop-shadow-lg">üèê BOLA BALING</h1>
            <p class="text-white/90 text-lg">Permainan Interaktif & Edukatif</p>
        </div>

        <!-- Main Menu -->
        <div id="mainMenu" class="space-y-6">
            <div class="bg-white/20 backdrop-blur-sm rounded-2xl p-6">
                <h2 class="text-2xl font-bold text-white text-center mb-6">Pilih Permainan</h2>
                
                <div class="lg:grid lg:grid-cols-2 lg:gap-6 space-y-4 lg:space-y-0">
                
                <!-- Game 1 -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 mb-4">
                    <div class="flex items-center space-x-4 mb-4">
                        <div class="text-4xl">üèÉ‚Äç‚ôÄÔ∏è</div>
                        <div>
                            <h3 class="text-xl font-bold text-gray-800">Lari dan Jawab</h3>
                            <p class="text-sm text-gray-600">Lari dan tangkap bola sambil jawab soalan</p>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-xl mb-4">
                        <h4 class="font-bold text-gray-800 mb-2">üìã Arahan:</h4>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>‚Ä¢ Tekan dan gerakkan pemain kiri-kanan</li>
                            <li>‚Ä¢ Tangkap bola yang jatuh dari atas</li>
                            <li>‚Ä¢ 60 saat, 5 soalan - setiap 10 saat</li>
                            <li>‚Ä¢ Jawab betul dalam 10 saat dapat 2x mata!</li>
                            <li>‚Ä¢ Jawab salah/terlepas - bola jatuh lebih laju</li>
                        </ul>
                    </div>
                    
                    <button onclick="startGame1()" class="w-full bg-gradient-to-r from-orange-400 to-red-500 text-white font-bold py-3 px-6 rounded-xl shadow-lg transform transition hover:scale-105 active:scale-95">
                        üöÄ Mula Permainan
                    </button>
                </div>
                
                <!-- Game 2 -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6">
                    <div class="flex items-center space-x-4 mb-4">
                        <div class="text-4xl">üÉè</div>
                        <div>
                            <h3 class="text-xl font-bold text-gray-800">Kad Kemahiran Menghantar</h3>
                            <p class="text-sm text-gray-600">Padankan kad kemahiran dengan penerangannya</p>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded-xl mb-4">
                        <h4 class="font-bold text-gray-800 mb-2">üìã Arahan:</h4>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>‚Ä¢ Ingat susunan 5 kad kemahiran</li>
                            <li>‚Ä¢ Tekan mula - kad diterbalikkan</li>
                            <li>‚Ä¢ Baca penerangan kemahiran, 5 pusingan</li>
                            <li>‚Ä¢ Pilih betul - kad kekal ditunjukkan dan dapat mata</li>
                            <li>‚Ä¢ Pilih salah - kad diterbalikkan semula</li>
                        </ul>
                    </div>
                    
                    <button onclick="startGame2()" class="w-full bg-gradient-to-r from-green-400 to-blue-500 text-white font-bold py-3 px-6 rounded-xl shadow-lg transform transition hover:scale-105 active:scale-95">
                        üß† Mula Permainan
                    </button>
                </div>
                </div>
            </div>
        </div>

        <!-- Game 1: Target & Quiz -->
        <div id="game1" class="hidden">
            <!-- Game Stats -->
            <div class="bg-white/20 backdrop-blur-sm rounded-2xl p-4 mb-4 flex justify-between items-center">
                <div class="text-center">
                    <div class="text-2xl font-bold text-white" id="score1">0</div>
                    <div class="text-white/80 text-sm">Mata</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-white" id="timer">60</div>
                    <div class="text-white/80 text-sm">Saat</div>
                </div>
                <div class="text-center">
                    <div class="text-lg font-bold text-white" id="multiplier">x1</div>
                    <div class="text-white/80 text-sm">Gandaan</div>
                </div>
            </div>

            <!-- Back to Menu Button -->
            <div class="text-center mb-4">
                <button onclick="goToMenu()" class="bg-gradient-to-r from-gray-500 to-gray-700 text-white font-bold py-2 px-4 rounded-xl shadow-lg transform transition hover:scale-105 active:scale-95 text-sm">
                    üè† Kembali ke Menu
                </button>
            </div>

            <!-- Quiz Section - Now at top -->
            <div id="quizSection1" class="hidden bg-gradient-to-r from-red-500 to-pink-600 rounded-2xl p-6 mb-4 border-4 border-yellow-400 shadow-2xl">
                <div class="text-center mb-4">
                    <h3 class="text-2xl font-bold text-white mb-2">‚è∞ SOALAN KUIZ!</h3>
                    <div class="text-4xl font-bold text-yellow-300 mb-2 animate-pulse" id="quizTimer">10</div>
                    <div id="question1" class="text-lg text-white mb-4 bg-black/20 p-3 rounded-xl"></div>
                </div>
                
                <div class="space-y-3">
                    <button onclick="answerQuiz(true)" class="w-full bg-gradient-to-r from-green-400 to-green-600 text-white font-bold py-4 px-6 rounded-xl shadow-lg transform transition hover:scale-105 active:scale-95 text-xl">
                        ‚úÖ BETUL
                    </button>
                    <button onclick="answerQuiz(false)" class="w-full bg-gradient-to-r from-red-400 to-red-600 text-white font-bold py-4 px-6 rounded-xl shadow-lg transform transition hover:scale-105 active:scale-95 text-xl">
                        ‚ùå SALAH
                    </button>
                </div>
            </div>

            <!-- Game Court -->
            <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-4 mb-4">
                <div class="court-bg court-lines h-80 lg:h-96 rounded-xl relative overflow-hidden cursor-grab" id="gameArea" onmousedown="startDrag(event)" ontouchstart="startDrag(event)">
                    <!-- Falling Balls Container -->
                    <div id="fallingBalls" class="absolute inset-0 pointer-events-none"></div>
                    
                    <!-- Player -->
                    <div id="player" class="absolute bottom-4 left-1/2 transform -translate-x-1/2 transition-all duration-300">
                        <div class="w-12 h-12 bg-gradient-to-b from-blue-400 to-blue-600 rounded-full flex items-center justify-center text-white text-xl shadow-lg">
                            üèÉ‚Äç‚ôÄÔ∏è
                        </div>
                    </div>
                    
                    <!-- Score Display -->
                    <div id="catchScore" class="absolute top-4 right-4 text-white font-bold text-lg bg-black/30 px-3 py-1 rounded-full">
                        Tangkapan: <span id="catchCount">0</span>
                    </div>
                </div>
                
                <div class="text-center mt-4">
                    <p class="text-gray-600 text-sm font-bold">Tekan dan gerakkan pemain kiri-kanan! Tangkap bola yang jatuh!</p>
                </div>
            </div>
        </div>

        <!-- Game 2: Card Matching -->
        <div id="game2" class="hidden">
            <!-- Game Stats -->
            <div class="bg-white/20 backdrop-blur-sm rounded-2xl p-4 mb-4 flex justify-between items-center">
                <div class="text-center">
                    <div class="text-2xl font-bold text-white" id="score2">0</div>
                    <div class="text-white/80 text-sm">Mata</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-white" id="round">1</div>
                    <div class="text-white/80 text-sm">Pusingan</div>
                </div>
            </div>

            <!-- Back to Menu Button -->
            <div class="text-center mb-4">
                <button onclick="goToMenu()" class="bg-gradient-to-r from-gray-500 to-gray-700 text-white font-bold py-2 px-4 rounded-xl shadow-lg transform transition hover:scale-105 active:scale-95 text-sm">
                    üè† Kembali ke Menu
                </button>
            </div>

            <!-- Cards Area -->
            <div class="bg-white/95 backdrop-blur-sm rounded-2xl p-6 mb-4">
                <h3 class="text-xl font-bold text-gray-800 text-center mb-4">Kemahiran Bola Baling</h3>
                
                <div id="cardsGrid" class="grid grid-cols-3 gap-3 mb-6">
                    <!-- 6 cards will be generated here (5 skills + 1 decoy) -->
                </div>
                
                <!-- Start Button -->
                <div id="startButton" class="text-center mb-6">
                    <button onclick="startGamePhase()" class="bg-gradient-to-r from-green-500 to-blue-600 text-white font-bold py-3 px-8 rounded-xl shadow-lg transform transition hover:scale-105 active:scale-95">
                        üöÄ Mula Permainan
                    </button>
                    <p class="text-gray-600 text-sm mt-2">Tekan bila sudah ingat kedudukan kad</p>
                </div>
                
                <!-- Question Area -->
                <div id="questionArea2" class="hidden bg-blue-50 p-4 rounded-xl">
                    <h4 class="font-bold text-gray-800 mb-2">ü§î Kemahiran manakah ini?</h4>
                    <p id="skillDescription" class="text-gray-700"></p>
                </div>
            </div>

            <!-- Game Phase Instructions -->
            <div id="gamePhase" class="bg-white/95 backdrop-blur-sm rounded-2xl p-4 mb-4 text-center">
                <div class="text-lg font-bold text-gray-800 mb-2">Fasa: <span id="phaseText">Ingat Kad</span></div>
                <div class="text-gray-600" id="phaseDesc">Ingat kedudukan setiap kemahiran...</div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameOver" class="hidden bg-white/95 backdrop-blur-sm rounded-2xl p-6 text-center">
            <div class="text-6xl mb-4" id="gameOverEmoji">üèÜ</div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2" id="gameOverTitle">Tamat!</h3>
            <div class="text-lg text-gray-600 mb-4">
                Mata Akhir: <span id="finalScore" class="font-bold text-2xl text-blue-600">0</span>
            </div>
            <div id="gameOverMessage" class="text-gray-600 mb-6"></div>
            
            <div class="space-y-3">
                <button onclick="restartGame()" class="w-full bg-gradient-to-r from-green-500 to-blue-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg transform transition hover:scale-105 active:scale-95">
                    üîÑ Main Semula
                </button>
                <button onclick="goToMenu()" class="w-full bg-gradient-to-r from-gray-500 to-gray-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transform transition hover:scale-105 active:scale-95">
                    üè† Menu Utama
                </button>
            </div>
        </div>
    </div>

    <script>
        let gameState = {
            currentGame: null,
            score: 0,
            timer: 10,
            multiplier: 1,
            round: 1,
            isAiming: false,
            gameInterval: null,
            quizInterval: null,
            quizTimerInterval: null,
            goalSpeed: 3,
            questionsAsked: 0,
            quizTimer: 5,
            gamePhase: 'aiming', // aiming, quiz
            totalRounds: 6,
            currentRound: 1,
            cardPositions: [],
            currentSkill: null,
            cardGamePhase: 'memorizing', // memorizing, playing, finished
            correctAnswers: 0,
            currentQuestion: 0,
            revealedCards: [],
            shuffledQuestions: [], // For randomized questions in Game 1
            shuffledSkills: [] // For randomized skills in Game 2
        };

        const skills = [
            {
                name: "Hantaran Atas Bahu",
                description: "Menggunakan sebelah tangan dominan untuk melakukan hantaran jarak jauh menuju ke sasaran",
                icon: "üí™"
            },
            {
                name: "Hantaran Bawah Lengan", 
                description: "Menggunakan sebelah tangan dominan untuk membuat balingan jarak dekat",
                icon: "ü§≤"
            },
            {
                name: "Hantaran Sisi",
                description: "Dilakukan secara menyisi ke sasaran menggunakan sebelah tangan dominan untuk hantaran jarak dekat",
                icon: "üëà"
            },
            {
                name: "Hantaran Aras Dada",
                description: "Menggunakan kedua-dua belah tangan untuk hantaran jarak dekat dengan gerakan pantas ke hadapan",
                icon: "üôå"
            },
            {
                name: "Hantaran Lantun",
                description: "Sesuai digunakan untuk jarak dekat dengan melantunkan bola kepada rakan sepasukan",
                icon: "‚ö°"
            }
        ];

        const quizQuestions = [
            {
                question: "Kemahiran mengadang bertujuan untuk mengawal pergerakan pemain lawan daripada menyerang",
                answer: true
            },
            {
                question: "Kemahiran mengacah memerlukan fokus dan tahap kepantasan yang baik untuk mengubah arah",
                answer: true
            },
            {
                question: "Jaringan atas kepala tidak memerlukan daya untuk menambah kelajuan bola",
                answer: false
            },
            {
                question: "Prinsip utama kemahiran menjaring termasuk keyakinan diri dan keseimbangan",
                answer: true
            },
            {
                question: "Kemahiran mengacah hanya digunakan untuk bertahan sahaja",
                answer: false
            },
            {
                question: "Ketepatan sasaran adalah penting dalam kemahiran menjaring",
                answer: true
            },
            {
                question: "Kemahiran mengadang hanya boleh dilakukan oleh pemain belakang",
                answer: false
            },
            {
                question: "Jaringan junam memerlukan kecekapan mencari ruang kosong",
                answer: true
            }
        ];

        // Shuffle function for randomization
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function startGame1() {
            gameState.currentGame = 1;
            gameState.score = 0;
            gameState.timer = 60;
            gameState.multiplier = 1;
            gameState.questionsAsked = 0;
            gameState.gamePhase = 'aiming';
            gameState.currentRound = 1;
            gameState.quizTimer = 10;
            
            // Shuffle questions for this game session
            gameState.shuffledQuestions = shuffleArray(quizQuestions);
            
            // Reset catching state
            catchingState.ballSpeed = 2000;
            catchingState.catchCount = 0;
            catchingState.playerPosition = 50;
            
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('game1').classList.remove('hidden');
            document.getElementById('catchCount').textContent = '0';
            
            updateGame1Display();
            startGame1Timer();
            startBallDropping();
        }

        function startGame2() {
            gameState.currentGame = 2;
            gameState.score = 0;
            gameState.round = 1;
            gameState.cardGamePhase = 'memorizing';
            gameState.correctAnswers = 0;
            gameState.currentQuestion = 0;
            gameState.revealedCards = [];
            
            // Shuffle skills for this game session
            gameState.shuffledSkills = shuffleArray(skills);
            
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('game2').classList.remove('hidden');
            
            updateGame2Display();
            generateCards();
        }

        function startGamePhase() {
            gameState.cardGamePhase = 'playing';
            gameState.currentQuestion = 1;
            
            // Hide start button and show question area
            document.getElementById('startButton').classList.add('hidden');
            document.getElementById('questionArea2').classList.remove('hidden');
            
            // Flip all cards face down
            flipAllCardsDown();
            
            // Start first question
            showNextQuestion();
            
            updateGame2Display();
        }

        function startGame1Timer() {
            gameState.gameInterval = setInterval(() => {
                if (gameState.gamePhase === 'aiming') {
                    gameState.timer--;
                    updateGame1Display();
                    
                    // Show quiz every 10 seconds (at 50, 40, 30, 20, 10)
                    if (gameState.timer > 0 && gameState.timer % 10 === 0 && gameState.questionsAsked < 5) {
                        showQuiz();
                    } else if (gameState.timer <= 0) {
                        endGame();
                    }
                }
            }, 1000);
        }

        function showQuiz() {
            gameState.gamePhase = 'quiz';
            gameState.quizTimer = 10;
            
            // Stop ball dropping during quiz
            stopBallDropping();
            
            // Use shuffled questions
            const randomQuestion = gameState.shuffledQuestions[gameState.questionsAsked % gameState.shuffledQuestions.length];
            document.getElementById('question1').textContent = randomQuestion.question;
            document.getElementById('quizSection1').classList.remove('hidden');
            document.getElementById('quizTimer').textContent = gameState.quizTimer;
            
            gameState.currentQuizAnswer = randomQuestion.answer;
            gameState.questionsAsked++;
            
            // Start quiz timer
            gameState.quizTimerInterval = setInterval(() => {
                gameState.quizTimer--;
                document.getElementById('quizTimer').textContent = gameState.quizTimer;
                
                if (gameState.quizTimer <= 0) {
                    // Time's up - treat as missed question
                    clearInterval(gameState.quizTimerInterval);
                    missedQuestion();
                }
            }, 1000);
        }

        function answerQuiz(answer) {
            clearInterval(gameState.quizTimerInterval);
            const correct = answer === gameState.currentQuizAnswer;
            
            if (correct) {
                gameState.multiplier = 2;
                showMessage('‚úÖ Betul!', 'Gandaan x2 diaktifkan!', 'success');
            } else {
                catchingState.ballSpeed = Math.max(600, catchingState.ballSpeed - 500);
                showMessage('‚ùå Salah!', 'Bola jatuh lebih laju!', 'error');
            }
            
            resumeGame();
        }
        
        function missedQuestion() {
            catchingState.ballSpeed = Math.max(600, catchingState.ballSpeed - 500);
            showMessage('‚è∞ Terlepas!', 'Masa tamat! Bola jatuh lebih laju!', 'error');
            
            resumeGame();
        }
        
        function resumeGame() {
            document.getElementById('quizSection1').classList.add('hidden');
            gameState.gamePhase = 'aiming';
            
            updateGame1Display();
            
            // Resume ball dropping
            startBallDropping();
            
            // Reset multiplier after 10 seconds if it was activated
            if (gameState.multiplier > 1) {
                setTimeout(() => {
                    gameState.multiplier = 1;
                    updateGame1Display();
                }, 10000);
            }
        }

        let catchingState = {
            ballSpeed: 2000, // milliseconds
            ballInterval: null,
            activeBalls: [],
            catchCount: 0,
            playerPosition: 50 // percentage from left
        };

        function startBallDropping() {
            if (catchingState.ballInterval) return;
            
            catchingState.ballInterval = setInterval(() => {
                if (gameState.gamePhase === 'aiming') {
                    createFallingBall();
                }
            }, 1500); // Drop ball every 1.5 seconds
        }

        function createFallingBall() {
            const gameArea = document.getElementById('gameArea');
            const fallingBalls = document.getElementById('fallingBalls');
            
            const ball = document.createElement('div');
            ball.className = 'ball absolute falling-ball';
            ball.style.setProperty('--fall-speed', catchingState.ballSpeed + 'ms');
            
            // Random horizontal position
            const randomX = Math.random() * 90; // 0-90% to keep within bounds
            ball.style.left = randomX + '%';
            ball.style.top = '-50px';
            
            const ballId = Date.now() + Math.random();
            ball.dataset.ballId = ballId;
            
            fallingBalls.appendChild(ball);
            catchingState.activeBalls.push({
                id: ballId,
                element: ball,
                x: randomX,
                startTime: Date.now()
            });
            
            // Remove ball after animation completes
            setTimeout(() => {
                if (ball.parentNode) {
                    ball.remove();
                    catchingState.activeBalls = catchingState.activeBalls.filter(b => b.id !== ballId);
                }
            }, catchingState.ballSpeed + 100);
        }

        let dragState = {
            isDragging: false,
            startX: 0,
            startPosition: 0
        };

        function startDrag(event) {
            if (gameState.gamePhase !== 'aiming') return;
            
            event.preventDefault();
            dragState.isDragging = true;
            
            const clientX = event.type === 'touchstart' ? event.touches[0].clientX : event.clientX;
            dragState.startX = clientX;
            dragState.startPosition = catchingState.playerPosition;
            
            // Add event listeners for drag and end
            if (event.type === 'touchstart') {
                document.addEventListener('touchmove', handleDrag);
                document.addEventListener('touchend', endDrag);
            } else {
                document.addEventListener('mousemove', handleDrag);
                document.addEventListener('mouseup', endDrag);
            }
        }

        function handleDrag(event) {
            if (!dragState.isDragging || gameState.gamePhase !== 'aiming') return;
            
            event.preventDefault();
            const clientX = event.type === 'touchmove' ? event.touches[0].clientX : event.clientX;
            
            const gameArea = document.getElementById('gameArea');
            const rect = gameArea.getBoundingClientRect();
            
            // Calculate movement delta as percentage
            const deltaX = clientX - dragState.startX;
            const deltaPercentage = (deltaX / rect.width) * 100;
            
            // Update position
            const newPosition = dragState.startPosition + deltaPercentage;
            catchingState.playerPosition = Math.max(5, Math.min(95, newPosition));
            
            // Move player
            const player = document.getElementById('player');
            player.style.left = catchingState.playerPosition + '%';
            
            // Check for ball catches
            checkBallCatch();
        }

        function endDrag(event) {
            dragState.isDragging = false;
            
            // Remove event listeners
            if (event.type === 'touchend') {
                document.removeEventListener('touchmove', handleDrag);
                document.removeEventListener('touchend', endDrag);
            } else {
                document.removeEventListener('mousemove', handleDrag);
                document.removeEventListener('mouseup', endDrag);
            }
        }

        function checkBallCatch() {
            const currentTime = Date.now();
            const tolerance = 25; // much larger tolerance for easier catching
            
            catchingState.activeBalls.forEach((ballData, index) => {
                const timePassed = currentTime - ballData.startTime;
                const fallProgress = timePassed / catchingState.ballSpeed;
                
                // Check if ball is at player level (very wide range for forgiving catching)
                if (fallProgress >= 0.6 && fallProgress <= 1.2) {
                    const ballX = ballData.x;
                    const playerX = catchingState.playerPosition;
                    
                    // Check if player is close enough to catch
                    if (Math.abs(ballX - playerX) <= tolerance) {
                        // Caught the ball!
                        catchingState.catchCount++;
                        gameState.score += 5 * gameState.multiplier;
                        
                        // Remove ball
                        ballData.element.remove();
                        catchingState.activeBalls.splice(index, 1);
                        
                        // Update displays
                        document.getElementById('catchCount').textContent = catchingState.catchCount;
                        updateGame1Display();
                        
                        showMessage('‚ö° Tangkap!', `+${5 * gameState.multiplier} mata!`, 'success');
                    }
                }
            });
        }

        function stopBallDropping() {
            if (catchingState.ballInterval) {
                clearInterval(catchingState.ballInterval);
                catchingState.ballInterval = null;
            }
            
            // Clear all active balls
            const fallingBalls = document.getElementById('fallingBalls');
            fallingBalls.innerHTML = '';
            catchingState.activeBalls = [];
        }

        function generateCards() {
            const cardsGrid = document.getElementById('cardsGrid');
            cardsGrid.innerHTML = '';
            
            // Create array with 5 shuffled skills + 1 decoy card
            const decoyCard = {
                name: "Kad Kosong",
                description: "Ini adalah kad kosong untuk mengelirukan anda!",
                icon: "üé≠"
            };
            
            // Combine skills with decoy and shuffle positions
            const allCards = [...gameState.shuffledSkills, decoyCard];
            gameState.cardPositions = shuffleArray(allCards);
            gameState.revealedCards = new Array(6).fill(false);
            
            // Create cards face up for memorization
            gameState.cardPositions.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                
                // Style decoy card differently
                if (card.name === "Kad Kosong") {
                    cardElement.classList.add('opacity-75');
                    cardElement.innerHTML = `
                        <div class="text-center">
                            <div class="text-2xl mb-2">${card.icon}</div>
                            <div class="text-xs leading-tight text-gray-200">${card.name}</div>
                        </div>
                    `;
                } else {
                    cardElement.innerHTML = `
                        <div class="text-center">
                            <div class="text-2xl mb-2">${card.icon}</div>
                            <div class="text-xs leading-tight">${card.name}</div>
                        </div>
                    `;
                }
                
                cardElement.dataset.skillIndex = index;
                cardElement.onclick = () => selectCard(cardElement, index);
                cardsGrid.appendChild(cardElement);
            });
        }

        function flipAllCardsDown() {
            const cards = document.querySelectorAll('#cardsGrid .card');
            cards.forEach((card, index) => {
                if (!gameState.revealedCards[index]) {
                    card.className = 'card card-back';
                    card.innerHTML = `
                        <div class="text-center">
                            <div class="text-3xl">‚ùì</div>
                        </div>
                    `;
                }
            });
        }

        function showNextQuestion() {
            if (gameState.currentQuestion <= 5) {
                // Pick a random skill that hasn't been revealed yet (excluding decoy cards)
                const availableSkills = gameState.cardPositions.filter((card, index) => 
                    !gameState.revealedCards[index] && card.name !== "Kad Kosong"
                );
                
                if (availableSkills.length > 0) {
                    const randomSkill = availableSkills[Math.floor(Math.random() * availableSkills.length)];
                    gameState.currentSkill = randomSkill;
                    document.getElementById('skillDescription').textContent = randomSkill.description;
                } else {
                    // All cards revealed, show final score
                    showFinalScore();
                    return;
                }
            } else {
                showFinalScore();
            }
        }

        function showFinalScore() {
            gameState.cardGamePhase = 'finished';
            
            // Hide question area
            document.getElementById('questionArea2').classList.add('hidden');
            
            // Show animated score
            const scoreAnimation = document.createElement('div');
            scoreAnimation.className = 'bg-gradient-to-r from-purple-500 to-pink-600 rounded-2xl p-8 text-center text-white mb-4';
            scoreAnimation.innerHTML = `
                <div class="text-6xl mb-4">üéØ</div>
                <h3 class="text-3xl font-bold mb-4">Tamat!</h3>
                <div class="text-2xl mb-4">
                    Betul: <span class="text-yellow-300 font-bold text-4xl">${gameState.correctAnswers}</span> / 5
                </div>
                <div class="text-lg">
                    ${gameState.correctAnswers === 5 ? 'üèÜ Sempurna!' : 
                      gameState.correctAnswers >= 3 ? 'üëç Bagus!' : 'üìö Cuba lagi!'}
                </div>
            `;
            
            const cardsArea = document.querySelector('#game2 .bg-white\\/95');
            cardsArea.appendChild(scoreAnimation);
            
            updateGame2Display();
            
            // Auto return to menu after 5 seconds
            setTimeout(() => {
                endGame();
            }, 5000);
        }

        function selectCard(cardElement, cardIndex) {
            if (gameState.cardGamePhase !== 'playing') return;
            
            const selectedCard = gameState.cardPositions[cardIndex];
            const correct = selectedCard.name === gameState.currentSkill.name;
            const isDecoy = selectedCard.name === "Kad Kosong";
            
            // Flip card to show content
            cardElement.classList.add('flip-card');
            
            setTimeout(() => {
                cardElement.className = 'card';
                
                // Style decoy card differently when revealed
                if (isDecoy) {
                    cardElement.classList.add('opacity-75');
                    cardElement.innerHTML = `
                        <div class="text-center">
                            <div class="text-2xl mb-2">${selectedCard.icon}</div>
                            <div class="text-xs leading-tight text-gray-200">${selectedCard.name}</div>
                        </div>
                    `;
                } else {
                    cardElement.innerHTML = `
                        <div class="text-center">
                            <div class="text-2xl mb-2">${selectedCard.icon}</div>
                            <div class="text-xs leading-tight">${selectedCard.name}</div>
                        </div>
                    `;
                }
                
                if (correct) {
                    // Correct answer - keep card revealed and add score
                    gameState.correctAnswers++;
                    gameState.score += 20;
                    gameState.revealedCards[cardIndex] = true;
                    cardElement.classList.add('bg-green-500');
                    showMessage('‚úÖ Betul!', 'Kad kekal ditunjukkan!', 'success');
                } else {
                    // Wrong answer (including decoy) - flip card back down after showing
                    cardElement.classList.add('bg-red-500');
                    if (isDecoy) {
                        showMessage('üé≠ Tertipu!', 'Itu kad kosong!', 'error');
                    } else {
                        showMessage('‚ùå Salah!', 'Kad diterbalikkan semula!', 'error');
                    }
                    
                    setTimeout(() => {
                        cardElement.className = 'card card-back';
                        cardElement.innerHTML = `
                            <div class="text-center">
                                <div class="text-3xl">‚ùì</div>
                            </div>
                        `;
                    }, 1500);
                }
                
                updateGame2Display();
                
                // Move to next question after delay
                setTimeout(() => {
                    gameState.currentQuestion++;
                    showNextQuestion();
                }, 2000);
                
            }, 300);
        }

        function updateGame1Display() {
            document.getElementById('score1').textContent = gameState.score;
            document.getElementById('timer').textContent = gameState.timer;
            document.getElementById('multiplier').textContent = 'x' + gameState.multiplier;
        }

        function updateGame2Display() {
            document.getElementById('score2').textContent = gameState.score;
            document.getElementById('round').textContent = `${gameState.currentQuestion}/5`;
            
            const phaseTexts = {
                memorizing: 'Ingat Kad',
                playing: 'Soalan ' + gameState.currentQuestion,
                finished: 'Selesai'
            };
            
            const phaseDescs = {
                memorizing: 'Ingat kedudukan setiap kemahiran...',
                playing: 'Pilih kad yang betul!',
                finished: 'Permainan selesai!'
            };
            
            document.getElementById('phaseText').textContent = phaseTexts[gameState.cardGamePhase];
            document.getElementById('phaseDesc').textContent = phaseDescs[gameState.cardGamePhase];
        }

        function showMessage(title, message, type) {
            const colors = {
                success: 'from-green-400 to-green-600',
                error: 'from-red-400 to-red-600',
                miss: 'from-orange-400 to-orange-600'
            };
            
            const messageEl = document.createElement('div');
            messageEl.className = `fixed top-20 right-4 bg-gradient-to-r ${colors[type]} text-white p-3 rounded-xl shadow-lg z-40 text-center max-w-xs`;
            messageEl.innerHTML = `
                <div class="text-lg font-bold mb-1">${title}</div>
                <div class="text-white/90 text-sm">${message}</div>
            `;
            
            document.body.appendChild(messageEl);
            
            setTimeout(() => {
                messageEl.remove();
            }, 1500);
        }

        function endGame() {
            if (gameState.gameInterval) {
                clearInterval(gameState.gameInterval);
            }
            
            // Stop ball dropping
            stopBallDropping();
            
            document.getElementById('game1').classList.add('hidden');
            document.getElementById('game2').classList.add('hidden');
            document.getElementById('gameOver').classList.remove('hidden');
            
            document.getElementById('finalScore').textContent = gameState.score;
            
            let emoji, title, message;
            
            if (gameState.currentGame === 1) {
                if (gameState.score >= 200) {
                    emoji = 'üèÜ';
                    title = 'Cemerlang!';
                    message = 'Anda seorang ahli bola baling yang hebat!';
                } else if (gameState.score >= 100) {
                    emoji = 'ü•à';
                    title = 'Bagus!';
                    message = 'Prestasi yang baik! Terus berlatih!';
                } else {
                    emoji = 'ü•â';
                    title = 'Cuba Lagi!';
                    message = 'Jangan berputus asa, latih lagi kemahiran anda!';
                }
            } else {
                const percentage = (gameState.score / 100) * 100;
                if (percentage >= 80) {
                    emoji = 'üß†';
                    title = 'Genius!';
                    message = 'Anda menguasai kemahiran bola baling dengan baik!';
                } else if (percentage >= 60) {
                    emoji = 'üëç';
                    title = 'Baik!';
                    message = 'Pengetahuan anda tentang bola baling cukup baik!';
                } else {
                    emoji = 'üìö';
                    title = 'Belajar Lagi!';
                    message = 'Baca semula tentang kemahiran bola baling!';
                }
            }
            
            document.getElementById('gameOverEmoji').textContent = emoji;
            document.getElementById('gameOverTitle').textContent = title;
            document.getElementById('gameOverMessage').textContent = message;
        }

        function restartGame() {
            if (gameState.currentGame === 1) {
                startGame1();
            } else {
                startGame2();
            }
            document.getElementById('gameOver').classList.add('hidden');
        }

        function goToMenu() {
            document.getElementById('gameOver').classList.add('hidden');
            document.getElementById('game1').classList.add('hidden');
            document.getElementById('game2').classList.add('hidden');
            document.getElementById('mainMenu').classList.remove('hidden');
            
            if (gameState.gameInterval) {
                clearInterval(gameState.gameInterval);
            }
            
            gameState = {
                currentGame: null,
                score: 0,
                timer: 60,
                multiplier: 1,
                round: 1,
                isAiming: false,
                gameInterval: null,
                quizInterval: null,
                goalSpeed: 3,
                questionsAsked: 0,
                cardPositions: [],
                currentSkill: null,
                gamePhase: 'showing',
                shuffledQuestions: [],
                shuffledSkills: []
            };
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98ba15a9632324d2',t:'MTc1OTk3MzEzMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
