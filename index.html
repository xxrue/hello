<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jenis Tanih - Kuiz Interaktif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        .soil-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .soil-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .quiz-option {
            transition: all 0.2s ease;
            transform: scale(1);
        }
        
        .quiz-option:active {
            transform: scale(0.98);
        }
        
        .correct {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            animation: pulse 0.5s ease-in-out;
        }
        
        .incorrect {
            background: linear-gradient(135deg, #f87171, #ef4444);
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .bounce {
            animation: bounce 0.6s ease-in-out;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #f39c12;
            animation: confetti-fall 3s linear infinite;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        .floating-emoji {
            position: absolute;
            font-size: 2rem;
            animation: float-up 2s ease-out forwards;
            pointer-events: none;
        }
        
        @keyframes float-up {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(1.5);
                opacity: 0;
            }
        }
        
        .wiggle {
            animation: wiggle 0.5s ease-in-out;
        }
        
        @keyframes wiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
        }
        
        .glow {
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            animation: glow-pulse 1s ease-in-out infinite alternate;
        }
        
        @keyframes glow-pulse {
            from { box-shadow: 0 0 20px rgba(255, 255, 255, 0.5); }
            to { box-shadow: 0 0 30px rgba(255, 255, 255, 0.8); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-400 via-pink-500 to-red-500 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-md">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2 drop-shadow-lg wiggle">🌍 Jenis Tanih</h1>
            <p class="text-white/90 text-lg">Kuiz Interaktif Pembelajaran 🎮</p>
            <div class="mt-2 text-2xl">🎯 🏆 ⭐</div>
        </div>

        <!-- Progress Bar -->
        <div class="bg-white/20 rounded-full h-3 mb-6 backdrop-blur-sm">
            <div id="progressBar" class="bg-gradient-to-r from-yellow-400 to-orange-500 h-3 rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
        </div>

        <!-- Score Display -->
        <div class="bg-white/10 backdrop-blur-md rounded-2xl p-4 mb-6 text-center glow">
            <div class="flex justify-between items-center">
                <div class="text-white">
                    <span class="text-sm opacity-80">🏅 Skor:</span>
                    <span id="score" class="text-2xl font-bold ml-2 text-yellow-300">0</span>
                </div>
                <div class="text-white">
                    <span class="text-sm opacity-80">📝 Soalan:</span>
                    <span id="questionCounter" class="text-2xl font-bold ml-2">1/10</span>
                </div>
            </div>
            <div id="streakDisplay" class="mt-2 text-sm text-yellow-200 hidden">
                🔥 Streak: <span id="streakCount">0</span>
            </div>
        </div>

        <!-- Stage Header -->
        <div id="stageHeader" class="bg-white/10 backdrop-blur-md rounded-2xl p-4 mb-4 text-center">
            <div class="text-3xl mb-2" id="stageEmoji">🖤</div>
            <h3 class="text-lg font-bold text-white" id="stageName">Tanih Chernozem</h3>
            <p class="text-sm text-white/80" id="stageDescription">Tanah Hitam - Padang Rumput</p>
            <div class="mt-2 text-xs text-white/60">
                Tahap <span id="stageNumber">1</span> daripada 6 • Soalan <span id="questionInStage">1</span> daripada 3
            </div>
        </div>

        <!-- Quiz Container -->
        <div id="quizContainer" class="bg-white/10 backdrop-blur-md rounded-3xl p-6 shadow-2xl">
            <div id="questionCard" class="fade-in">
                <h2 id="questionText" class="text-xl font-semibold text-white mb-6 leading-relaxed"></h2>
                <div id="optionsContainer" class="space-y-3"></div>
            </div>
        </div>

        <!-- Next Button -->
        <button id="nextBtn" class="w-full mt-6 bg-gradient-to-r from-green-400 to-blue-500 text-white font-bold py-4 px-6 rounded-2xl shadow-lg transform transition-all duration-200 hover:scale-105 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            Soalan Seterusnya →
        </button>

        <!-- Stage Complete Modal -->
        <div id="stageCompleteModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
            <div class="bg-white/10 backdrop-blur-md rounded-3xl p-6 max-w-sm w-full text-center">
                <div class="text-6xl mb-4">🎊</div>
                <h3 class="text-2xl font-bold text-white mb-2">Tahap Selesai!</h3>
                <p id="stageCompleteText" class="text-white/80 mb-4"></p>
                <div class="bg-white/20 rounded-xl p-3 mb-4">
                    <p class="text-yellow-300 font-bold text-lg" id="stageScore">3/3 Betul!</p>
                </div>
                <button id="continueBtn" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold py-3 px-6 rounded-xl">
                    <span id="continueBtnText">Teruskan ke Tahap Seterusnya 🚀</span>
                </button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="resultsScreen" class="hidden bg-white/10 backdrop-blur-md rounded-3xl p-6 shadow-2xl text-center">
            <div class="text-6xl mb-4">🏆</div>
            <h2 class="text-3xl font-bold text-white mb-4">Tahniah Selesai!</h2>
            
            <!-- Overall Score -->
            <div class="bg-white/20 rounded-2xl p-4 mb-6">
                <p class="text-white text-lg mb-2">Skor Keseluruhan:</p>
                <p id="finalScore" class="text-4xl font-bold text-yellow-300"></p>
                <p id="scoreMessage" class="text-white/80 mt-2"></p>
            </div>

            <!-- Stage Breakdown -->
            <div class="bg-white/10 rounded-2xl p-4 mb-6">
                <h3 class="text-white font-bold mb-3">📊 Prestasi Mengikut Tahap:</h3>
                <div id="stageBreakdown" class="space-y-2 text-sm"></div>
            </div>

            <button id="restartBtn" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold py-4 px-6 rounded-2xl shadow-lg transform transition-all duration-200 hover:scale-105 active:scale-95">
                🔄 Main Semula
            </button>
        </div>
    </div>

    <script>
        const soilStages = [
            {
                name: "Tanih Chernozem",
                emoji: "🖤",
                description: "Tanah Hitam - Padang Rumput",
                theme: "from-gray-800 via-gray-700 to-gray-900",
                accent: "from-yellow-400 to-amber-500",
                questions: [
                    {
                        question: "🌾 Tanih chernozem membeku pada musim apa?",
                        options: ["A) Musim Bunga", "B) Musim Panas", "C) Musim Sejuk", "D) Musim Luruh"],
                        correct: 2,
                        explanation: "Tanih chernozem membeku pada musim sejuk di kawasan padang rumput hawa sederhana.",
                        emoji: "❄️"
                    },
                    {
                        question: "🌱 Tumbuhan utama di kawasan tanih chernozem adalah?",
                        options: ["A) Rumput-rumput", "B) Kaktus", "C) Pokok Pain", "D) Kulat"],
                        correct: 0,
                        explanation: "Kawasan ini dipenuhi rumput-rumput, bunga-bungaan dan tumbuhan renek.",
                        emoji: "🌾"
                    },
                    {
                        question: "🐺 Haiwan manakah yang hidup di kawasan tanih chernozem?",
                        options: ["A) Penguin", "B) Unta", "C) Beruang Kutub", "D) Coyote"],
                        correct: 3,
                        explanation: "Coyote, saiga antelope, badger dan bobcat hidup di kawasan ini.",
                        emoji: "🐺"
                    }
                ]
            },
            {
                name: "Tanih Permafrost",
                emoji: "🧊",
                description: "Tanah Beku - Tundra",
                theme: "from-blue-600 via-blue-700 to-blue-800",
                accent: "from-white to-blue-100",
                questions: [
                    {
                        question: "❄️ Tanih permafrost mempunyai ciri-ciri apa?",
                        options: ["A) Membeku sepanjang tahun", "B) Panas sepanjang tahun", "C) Lembap sahaja", "D) Kering sahaja"],
                        correct: 0,
                        explanation: "Tanih permafrost kurang subur, sejuk dan membeku sepanjang tahun.",
                        emoji: "🧊"
                    },
                    {
                        question: "🍄 Tumbuhan yang boleh hidup di kawasan tundra adalah?",
                        options: ["A) Pokok Kelapa", "B) Bunga Ros", "C) Liken dan Lumut", "D) Padi"],
                        correct: 2,
                        explanation: "Hanya tumbuhan tahan sejuk seperti liken, lumut, kulampair, willow dan birch.",
                        emoji: "🍄"
                    },
                    {
                        question: "🐻‍❄️ Haiwan Artik yang hidup di kawasan ini adalah?",
                        options: ["A) Singa", "B) Gajah", "C) Zirafah", "D) Beruang Kutub"],
                        correct: 3,
                        explanation: "Beruang kutub, karibu, musang artik, arnab artik dan lemming hidup di sini.",
                        emoji: "🐻‍❄️"
                    }
                ]
            },
            {
                name: "Tanih Aridisols",
                emoji: "🏜️",
                description: "Tanah Kering - Gurun Panas",
                theme: "from-yellow-400 via-orange-500 to-red-600",
                accent: "from-yellow-300 to-orange-400",
                questions: [
                    {
                        question: "🏜️ Ciri utama tanih aridisols adalah?",
                        options: ["A) Lembap dan subur", "B) Sejuk dan beku", "C) Berair", "D) Kering dan tandus"],
                        correct: 3,
                        explanation: "Tanih aridisols adalah tanah yang kering dan tandus di kawasan gurun panas.",
                        emoji: "🏜️"
                    },
                    {
                        question: "🌵 Tumbuhan yang mampu hidup di gurun adalah?",
                        options: ["A) Pokok Kaktus", "B) Bunga Orkid", "C) Rumput Biasa", "D) Semanggi"],
                        correct: 0,
                        explanation: "Hanya tumbuhan berakar panjang seperti kaktus, akasia dan kurma yang boleh hidup.",
                        emoji: "🌵"
                    },
                    {
                        question: "🐪 Haiwan gurun yang terkenal adalah?",
                        options: ["A) Penguin", "B) Katak", "C) Unta", "D) Ikan"],
                        correct: 2,
                        explanation: "Unta, rusa gazelle, oryx, musang fennec dan tikus jerboa hidup di gurun.",
                        emoji: "🐪"
                    }
                ]
            },
            {
                name: "Tanih Latosol",
                emoji: "🌳",
                description: "Tanah Merah/Kuning - Hutan Tropika",
                theme: "from-green-400 via-emerald-500 to-green-600",
                accent: "from-red-400 to-yellow-500",
                questions: [
                    {
                        question: "🎨 Warna tanih latosol adalah?",
                        options: ["A) Hitam", "B) Biru", "C) Merah atau Kuning", "D) Putih"],
                        correct: 2,
                        explanation: "Tanih latosol berwarna merah atau kuning, berpasir, liat atau lembap.",
                        emoji: "🎨"
                    },
                    {
                        question: "🌳 Kawasan tanih latosol terdapat di?",
                        options: ["A) Hutan Hujan Tropika", "B) Gurun", "C) Kutub", "D) Pergunungan Tinggi"],
                        correct: 0,
                        explanation: "Tanih latosol terdapat di Hutan Hujan Tropika dan Hutan Monsun Tropika.",
                        emoji: "🌳"
                    },
                    {
                        question: "🐘 Haiwan besar yang hidup di hutan tropika adalah?",
                        options: ["A) Penguin", "B) Beruang Kutub", "C) Unta", "D) Gajah"],
                        correct: 3,
                        explanation: "Gajah, harimau, beruang, kancil dan cerpelai hidup di kawasan ini.",
                        emoji: "🐘"
                    }
                ]
            },
            {
                name: "Tanih Podzol",
                emoji: "🌲",
                description: "Tanah Nipis - Hutan Konifer",
                theme: "from-green-700 via-green-800 to-green-900",
                accent: "from-green-400 to-emerald-500",
                questions: [
                    {
                        question: "🌲 Tanih podzol terdapat di kawasan?",
                        options: ["A) Pantai", "B) Gurun", "C) Hutan Konifer", "D) Padang Rumput"],
                        correct: 2,
                        explanation: "Tanih podzol yang nipis, berasid dan beku terdapat di kawasan Hutan Konifer.",
                        emoji: "🌲"
                    },
                    {
                        question: "🌿 Ciri akar tumbuhan di kawasan ini adalah?",
                        options: ["A) Panjang dan dalam", "B) Pendek dan tidak menerjah jauh", "C) Terapung di air", "D) Tahan api"],
                        correct: 1,
                        explanation: "Akar tumbuhan pendek seperti pokok pain, cedar, birch, fir dan sprus.",
                        emoji: "🌿"
                    },
                    {
                        question: "🦌 Haiwan hutan konifer yang besar adalah?",
                        options: ["A) Tikus", "B) Katak", "C) Kupu-kupu", "D) Rusa Besar"],
                        correct: 3,
                        explanation: "Rusa besar, elk, lynx, brown bear dan harimau Siberia hidup di sini.",
                        emoji: "🦌"
                    }
                ]
            },
            {
                name: "Tanih Terra Rossa",
                emoji: "🍇",
                description: "Tanah Merah Coklat - Mediterranean",
                theme: "from-red-400 via-orange-500 to-amber-600",
                accent: "from-green-500 to-olive-600",
                questions: [
                    {
                        question: "🔍 Tanih terra rossa adalah campuran?",
                        options: ["A) Ais dan salji", "B) Air dan minyak", "C) Tanah liat dan pasir", "D) Rumput dan daun"],
                        correct: 2,
                        explanation: "Terra rossa adalah campuran tanah liat dan pasir, warna merah atau coklat kemerahan.",
                        emoji: "🔴"
                    },
                    {
                        question: "🌿 Tumbuhan Mediterranean yang wangi adalah?",
                        options: ["A) Rosemary", "B) Kaktus", "C) Kulat", "D) Padi"],
                        correct: 0,
                        explanation: "Rosemary, lavender, laurel dan pain tumbuh di kawasan Mediterranean.",
                        emoji: "🌿"
                    },
                    {
                        question: "🦌 Haiwan yang hidup di hutan Mediterranean adalah?",
                        options: ["A) Penguin", "B) Unta", "C) Beruang Kutub", "D) Rusa"],
                        correct: 3,
                        explanation: "Serigala, rusa, landak dan helang hidup di kawasan Mediterranean.",
                        emoji: "🦌"
                    }
                ]
            }
        ];

        let currentStage = 0;
        let currentQuestionInStage = 0;
        let score = 0;
        let answered = false;
        let streak = 0;
        let maxStreak = 0;
        let stageScores = [0, 0, 0, 0, 0, 0];

        const questionText = document.getElementById('questionText');
        const optionsContainer = document.getElementById('optionsContainer');
        const nextBtn = document.getElementById('nextBtn');
        const scoreElement = document.getElementById('score');
        const questionCounter = document.getElementById('questionCounter');
        const progressBar = document.getElementById('progressBar');
        const quizContainer = document.getElementById('quizContainer');
        const resultsScreen = document.getElementById('resultsScreen');
        const finalScore = document.getElementById('finalScore');
        const scoreMessage = document.getElementById('scoreMessage');
        const restartBtn = document.getElementById('restartBtn');
        const streakDisplay = document.getElementById('streakDisplay');
        const streakCount = document.getElementById('streakCount');
        
        // Stage elements
        const stageHeader = document.getElementById('stageHeader');
        const stageEmoji = document.getElementById('stageEmoji');
        const stageName = document.getElementById('stageName');
        const stageDescription = document.getElementById('stageDescription');
        const stageNumber = document.getElementById('stageNumber');
        const questionInStage = document.getElementById('questionInStage');
        const stageCompleteModal = document.getElementById('stageCompleteModal');
        const stageCompleteText = document.getElementById('stageCompleteText');
        const stageScore = document.getElementById('stageScore');
        const continueBtn = document.getElementById('continueBtn');
        const continueBtnText = document.getElementById('continueBtnText');
        const stageBreakdown = document.getElementById('stageBreakdown');

        // Theme and celebration functions
        function updateTheme() {
            const stage = soilStages[currentStage];
            document.body.className = `bg-gradient-to-br ${stage.theme} min-h-screen transition-all duration-1000`;
        }

        function createConfetti() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7'];
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                document.body.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 5000);
            }
        }

        function createStageTransition(stageEmoji) {
            // Create multiple floating stage emojis
            for (let i = 0; i < 15; i++) {
                const floatingEmoji = document.createElement('div');
                floatingEmoji.className = 'floating-emoji';
                floatingEmoji.textContent = stageEmoji;
                floatingEmoji.style.left = Math.random() * window.innerWidth + 'px';
                floatingEmoji.style.top = Math.random() * window.innerHeight + 'px';
                floatingEmoji.style.fontSize = (Math.random() * 2 + 1.5) + 'rem';
                floatingEmoji.style.animationDelay = Math.random() * 0.5 + 's';
                document.body.appendChild(floatingEmoji);
                
                setTimeout(() => floatingEmoji.remove(), 2000);
            }
        }

        function createFloatingEmoji(emoji, x, y) {
            const floatingEmoji = document.createElement('div');
            floatingEmoji.className = 'floating-emoji';
            floatingEmoji.textContent = emoji;
            floatingEmoji.style.left = x + 'px';
            floatingEmoji.style.top = y + 'px';
            document.body.appendChild(floatingEmoji);
            
            setTimeout(() => floatingEmoji.remove(), 2000);
        }

        function playSuccessAnimation() {
            scoreElement.classList.add('bounce');
            setTimeout(() => scoreElement.classList.remove('bounce'), 600);
        }

        function updateStreak(isCorrect) {
            if (isCorrect) {
                streak++;
                maxStreak = Math.max(maxStreak, streak);
                if (streak >= 3) {
                    streakDisplay.classList.remove('hidden');
                    streakCount.textContent = streak;
                    if (streak === 5) {
                        createConfetti();
                    }
                }
            } else {
                streak = 0;
                if (streakDisplay.classList.contains('hidden') === false) {
                    streakDisplay.classList.add('hidden');
                }
            }
        }

        function loadQuestion() {
            answered = false;
            nextBtn.disabled = true;
            
            const stage = soilStages[currentStage];
            const question = stage.questions[currentQuestionInStage];
            
            // Update theme
            updateTheme();
            
            // Update stage header
            stageEmoji.textContent = stage.emoji;
            stageName.textContent = stage.name;
            stageDescription.textContent = stage.description;
            stageNumber.textContent = currentStage + 1;
            questionInStage.textContent = currentQuestionInStage + 1;
            
            // Update question
            questionText.textContent = question.question;
            const totalQuestions = soilStages.length * 3;
            const currentQuestionNumber = (currentStage * 3) + currentQuestionInStage + 1;
            questionCounter.textContent = `${currentQuestionNumber}/${totalQuestions}`;
            
            // Update progress bar
            const progress = ((currentQuestionNumber - 1) / totalQuestions) * 100;
            progressBar.style.width = `${progress}%`;
            
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'quiz-option w-full bg-white/20 backdrop-blur-sm text-white font-medium py-4 px-6 rounded-xl text-left hover:bg-white/30 border border-white/20';
                button.textContent = option;
                button.onclick = () => selectAnswer(index, button);
                optionsContainer.appendChild(button);
            });
        }

        function selectAnswer(selectedIndex, buttonElement) {
            if (answered) return;
            
            answered = true;
            const stage = soilStages[currentStage];
            const question = stage.questions[currentQuestionInStage];
            const isCorrect = selectedIndex === question.correct;
            
            // Update streak
            updateStreak(isCorrect);
            
            // Style all buttons
            const allButtons = optionsContainer.querySelectorAll('button');
            allButtons.forEach((btn, index) => {
                btn.disabled = true;
                if (index === question.correct) {
                    btn.className = 'quiz-option w-full text-white font-medium py-4 px-6 rounded-xl text-left correct border border-green-300';
                } else if (index === selectedIndex && !isCorrect) {
                    btn.className = 'quiz-option w-full text-white font-medium py-4 px-6 rounded-xl text-left incorrect border border-red-300';
                } else {
                    btn.className = 'quiz-option w-full bg-white/10 text-white/60 font-medium py-4 px-6 rounded-xl text-left border border-white/10';
                }
            });
            
            if (isCorrect) {
                score += 10;
                stageScores[currentStage] += 10;
                scoreElement.textContent = score;
                playSuccessAnimation();
                
                // Create floating emoji at button position
                const rect = buttonElement.getBoundingClientRect();
                createFloatingEmoji(question.emoji, rect.left + rect.width/2, rect.top);
                
                // No extra points for streaks - keeping it fair
            }
            
            // Show explanation with fun styling
            setTimeout(() => {
                const explanation = document.createElement('div');
                explanation.className = 'mt-4 p-4 bg-white/20 backdrop-blur-sm rounded-xl border border-white/30 fade-in';
                const emojiReaction = isCorrect ? '🎉' : '🤔';
                explanation.innerHTML = `<p class="text-white text-sm"><strong>${emojiReaction} Penjelasan:</strong> ${question.explanation}</p>`;
                optionsContainer.appendChild(explanation);
            }, 500);
            
            nextBtn.disabled = false;
        }

        function showStageComplete() {
            const stage = soilStages[currentStage];
            const stageScoreValue = stageScores[currentStage];
            
            stageCompleteText.textContent = `Anda telah selesaikan ${stage.name}!`;
            stageScore.textContent = `${stageScoreValue}/30 Mata`;
            
            // Check if this is the final stage
            if (currentStage === soilStages.length - 1) {
                continueBtnText.textContent = "Lihat Keputusan Akhir 🏆";
                // Change to results theme
                document.body.className = 'bg-gradient-to-br from-purple-600 via-indigo-600 to-blue-700 min-h-screen transition-all duration-1000';
            } else {
                continueBtnText.textContent = "Teruskan ke Tahap Seterusnya 🚀";
            }
            
            stageCompleteModal.classList.remove('hidden');
        }

        function nextQuestion() {
            currentQuestionInStage++;
            
            // Check if stage is complete
            if (currentQuestionInStage >= 3) {
                showStageComplete();
                return;
            }
            
            // Continue to next question in same stage
            document.getElementById('questionCard').classList.remove('fade-in');
            setTimeout(() => {
                loadQuestion();
                document.getElementById('questionCard').classList.add('fade-in');
            }, 100);
        }

        function nextStage() {
            currentStage++;
            currentQuestionInStage = 0;
            
            stageCompleteModal.classList.add('hidden');
            
            if (currentStage >= soilStages.length) {
                showResults();
                return;
            }
            
            // Create stage transition animation
            const nextStage = soilStages[currentStage];
            createStageTransition(nextStage.emoji);
            
            // Load first question of next stage
            document.getElementById('questionCard').classList.remove('fade-in');
            setTimeout(() => {
                loadQuestion();
                document.getElementById('questionCard').classList.add('fade-in');
            }, 100);
        }

        function showResults() {
            // Update progress to 100%
            progressBar.style.width = '100%';
            
            // Set final results theme (different from all stages)
            document.body.className = 'bg-gradient-to-br from-purple-600 via-indigo-600 to-blue-700 min-h-screen transition-all duration-1000';
            
            // Hide quiz elements
            quizContainer.classList.add('hidden');
            nextBtn.classList.add('hidden');
            stageHeader.classList.add('hidden');
            resultsScreen.classList.remove('hidden');
            
            const totalPossible = soilStages.length * 30;
            const percentage = (score / totalPossible) * 100;
            finalScore.textContent = `${score}/${totalPossible}`;
            
            let message = '';
            let celebration = '';
            if (percentage >= 90) {
                message = '🌟 Cemerlang! Anda pakar tanih!';
                celebration = '🎊🎉🏆';
                createConfetti();
            } else if (percentage >= 70) {
                message = '👍 Bagus! Pengetahuan yang baik!';
                celebration = '🎉✨🌟';
            } else if (percentage >= 50) {
                message = '📚 Tidak buruk, teruskan belajar!';
                celebration = '💪📖✨';
            } else {
                message = '💪 Jangan putus asa, cuba lagi!';
                celebration = '🌱💪🎯';
            }
            
            scoreMessage.innerHTML = `${celebration}<br>${message}<br><br>🔥 Streak Terbaik: ${maxStreak}`;
            
            // Show stage breakdown
            stageBreakdown.innerHTML = '';
            soilStages.forEach((stage, index) => {
                const stageResult = document.createElement('div');
                const stagePercentage = (stageScores[index] / 30) * 100;
                let stageEmoji = '';
                if (stagePercentage === 100) stageEmoji = '🏆';
                else if (stagePercentage >= 67) stageEmoji = '⭐';
                else if (stagePercentage >= 33) stageEmoji = '👍';
                else stageEmoji = '📚';
                
                stageResult.className = 'flex justify-between items-center text-white/80 bg-white/5 rounded-lg p-2';
                stageResult.innerHTML = `
                    <span>${stage.emoji} ${stage.name}</span>
                    <span>${stageEmoji} ${stageScores[index]}/30</span>
                `;
                stageBreakdown.appendChild(stageResult);
            });
            
            // Add celebration animation to results
            resultsScreen.classList.add('bounce');
            setTimeout(() => resultsScreen.classList.remove('bounce'), 600);
        }

        function restartQuiz() {
            currentStage = 0;
            currentQuestionInStage = 0;
            score = 0;
            streak = 0;
            maxStreak = 0;
            stageScores = [0, 0, 0, 0, 0, 0];
            scoreElement.textContent = '0';
            streakDisplay.classList.add('hidden');
            
            // Show quiz elements
            quizContainer.classList.remove('hidden');
            nextBtn.classList.remove('hidden');
            stageHeader.classList.remove('hidden');
            resultsScreen.classList.add('hidden');
            stageCompleteModal.classList.add('hidden');
            
            // Reset to first stage theme
            document.body.className = 'bg-gradient-to-br from-gray-800 via-gray-700 to-gray-900 min-h-screen';
            
            loadQuestion();
        }

        // Event listeners
        nextBtn.addEventListener('click', nextQuestion);
        restartBtn.addEventListener('click', restartQuiz);
        continueBtn.addEventListener('click', nextStage);

        // Initialize quiz
        loadQuestion();
        
        // Show entry animation for first stage
        setTimeout(() => {
            createStageTransition(soilStages[0].emoji);
        }, 500);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9846e7e6b4880969',t:'MTc1ODc2NTM5NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
